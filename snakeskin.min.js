var Snakeskin={VERSION:"1.1.2",Filters:{},cache:{}},SS=Snakeskin;
(function(G){var z;Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});String.prototype.trim||(String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),c=a.length;/\s/.test(a.charAt(c-=1)););return a.substring(0,c+1)});Snakeskin.forEach=function(a,c){var d=-1,g,b;if(Array.isArray(a))for(g=a.length;++d<g;)c(a[d],d,0===d,d===g-1,g);else{d=0;for(b in a)a.hasOwnProperty(b)&&d++;g=d;d=-1;for(b in a)a.hasOwnProperty(b)&&(d++,c(a[b],b,d,0===
d,d===g-1,g))}};var W={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},X=/[&<>"'\/]/g,Y=function(a){return W[a]};Snakeskin.Filters.html=function(a){return String(a).replace(X,Y)};var Z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"},$=/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,aa=function(a){return Z[a]};Snakeskin.Filters.uhtml=function(a){return String(a).replace($,aa)};var ba=/<\/?[^>]+>/g;Snakeskin.Filters.stripTags=function(a){return String(a).replace(ba,
"")};var ca=/%5B/g,da=/%5D/g;Snakeskin.Filters.uri=function(){return encodeURI(String(url)).replace(ca,"[").replace(da,"]")};Snakeskin.Filters.upper=function(a){return String(a).toUpperCase()};Snakeskin.Filters.ucfirst=function(a){a=String(a);return a.charAt(0).toUpperCase()+a.substring(1)};Snakeskin.Filters.lower=function(a){return String(a).toLowerCase()};Snakeskin.Filters.lcfirst=function(a){a=String(a);return a.charAt(0).toLowerCase()+a.substring(1)};Snakeskin.Filters.trim=function(a){return String(a).trim()};
var ea=/\s{2,}/g;Snakeskin.Filters.collapse=function(a){return String(a).replace(ea," ").trim()};Snakeskin.Filters.truncate=function(a,c,d){a=String(a);if(!a||a.length<=c)return a;a=a.substring(0,c-1);var g;for(c=a.length;c--&&d;)if(" "===a.charAt(c))g=c;else if("undefined"!==typeof g)break;return("undefined"!==typeof g?a.substring(0,g):a)+"\u2026"};Snakeskin.Filters.repeat=function(a,c){return Array(c||2).join(a)};Snakeskin.Filters.remove=function(a,c){return String(a).replace(c,"")};Snakeskin.Filters.replace=
function(a,c,d){return String(a).replace(c,d)};Array.prototype.forEach||(Array.prototype.forEach=function(a,c){var d=-1,g=this.length;if(c)for(;(d+=1)<g;)a.call(c,this[d],d,this);else for(;(d+=1)<g;)a(this[d],d,this)});Array.prototype.some||(Array.prototype.some=function(a,c){var d=-1,g=this.length,b;if(c)for(;(d+=1)<g;){if(b=a.call(c,this[d],d,this))return!0}else for(;(d+=1)<g;)if(b=a(this[d],d,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(a,c){var d=0,g=this.length,
b;if(1===g)return this[0];for(b="undefined"!==typeof c?c:this[0];(d+=1)<g;)b=a(b,this[d],d,this);return b});var H={},D={},w={},L={},E={},M={},I={},x={},N={},P=[],R={'"':!0,"'":!0},fa={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_TMP_RESULT__:!0,__SNAKESKIN_CDATA__:!0},k;Snakeskin._getExtStr=function(a,c){if(!H[N[a]])throw k=Error('The specified pattern ("'+N[a]+'" for "'+a+'") for inheritance is not defined ('+this._genError(c)+")!"),k.name="Snakeskin Error",k;for(var d=N[a],g=H[d],b,j,e,h,l=-1,q,n=0,x=[],
m,A,r;6>++l;)for(h in 0===l?(b=D[a],j=D[d]):2===l?(b=E[a],j=E[d],n=M[d],q=null):4===l&&(b=w[a],j=w[d],n=L[d],q=null),b)if(b.hasOwnProperty(h))if(r=0,e=H[a].substring(b[h].from,b[h].to),j[h]&&(m=e.length-H[d].substring(j[h].from,j[h].to).length),A=j[h]?j[h].from:n,x.sort(function(a,b){if(a.val>b.val)return 1;if(a.val===b.val)return 0;if(a.val<b.val)return-1}).some(function(a){if(a.val<A)r+=a.adv;else return!0}),j[h]&&0===l%2)1<l&&(q=j[h].from+r+e.length,n+=m,q>n&&(n=q+(4===l?5:1))),g=g.substring(0,
j[h].from+r)+e+g.substring(j[h].to+r),x.push({val:j[h].from,adv:m});else if(!j[h])if(1===l)g+="{"+h+"}"+e+"{end}";else if(3===l||5===l)null===q&&(q=n,n+=r),e=3===l?"{"+e+"}":"{"+h+"}"+e+"{end}",g=g.substring(0,n)+e+g.substring(n),x.push({val:q,adv:e.length}),n+=e.length;return g};Snakeskin._escape=function(a){var c;a=a.split("");a.forEach(function(d,g){if(R[d]){if(!a[g-1]||"\\"!==a[g-1])c&&c===d?c=!1:c||(c=d)}else if(c)switch(d){case "|":a[g]="__SNAKESKIN_ESCAPE__PIPE";break;case "=":a[g]="__SNAKESKIN_ESCAPE__EQUAL";
break;case ",":a[g]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":a[g]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":a[g]="__SNAKESKIN_ESCAPE__BCLOSE"}});return a=a.join("")};Snakeskin._descape=function(a){return a.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,")")};Snakeskin._genError=function(a){var c,d="";for(c in a)a.hasOwnProperty(c)&&(d=a[c].innerHTML?
d+(c+": (class: "+(a[c].className||"undefined")+", id: "+(a[c].id||"undefined")+"), "):d+(c+": "+a[c]+", "));return d.replace(/, $/,"")};Snakeskin.compile=function(a,c,d,g){g=g||{};a.innerHTML&&(g.node=a);a=String(a.innerHTML||a).replace(/{cdata}([\s\S]*?){end\s+cdata}/gm,function(a,b){P.push(b);return"__SNAKESKIN_CDATA__"+(P.length-1)}).replace(/\/\/.*/gm,"").replace(/[\t\v\n\r]*/gm,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var b=""+(!d?"/* This code is generated automatically, don't alter it. */":
"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);exec();return this;};function exec() {":""),j,e=null,h,l,q,n,z=0,m=0,A,r=[],y=[],u,s,Q=0,S,B={},C=[],J,K=[],T,U={},f="",O,t,V,p=-1,v,F;++p<a.length;){j=a.charAt(p);if(!F)if("{"===j)if(n)z++;else{n=!0;continue}else if("}"===j&&(!z||!z--)){n=!1;f=this._escape(f);switch(f.split(" ")[0]){case "template":if(0!==m)throw k=Error("Missing closing or opening tag in the template (command: {"+f+'}, template: "'+
e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;m++;v=p+1;e=f.replace(/^template\s+/,"").replace(/\(.*/,"");if(d)break;/\s+extends\s+/.test(f)&&(h=f.replace(/.*?\s+extends\s+(.*)/,"$1"));l=f.replace(/.*?\((.*?)\).*/,"$1");D[e]={};w[e]={};L[e]=0;E[e]={};M[e]=0;I[e]={};N[e]=h;b+="/* Snakeskin template: "+e+"; "+l.replace(/=(.*?)(?:,|$)/g,"")+" */";/\./.test(e)||c?(e.split(".").reduce(function(a,d,e){U[a]||(b+="if (typeof "+(c?"exports.":"")+a+" === 'undefined') { "+(c?"exports.":1===e?G?
"var ":"window.":"")+a+" = {}; }",U[a]=!0);return a+"."+d}),b+=(c?"exports.":"")+e+"= function ("):b+=(!G?"window."+e+" = ":"")+"function "+(G?e:"")+"(";l=l.split(",");x[e]=x[h]?x[h].concat(l):l;q="";x[h]&&x[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();l.forEach(function(d,e){var c=d.split("=");c[0]=c[0].trim();c[1]=c[1]&&c[1].trim();b[0]===c[0]&&"undefined"===typeof c[1]&&(l[e]=a)})});l.forEach(function(a,d){var c=a.split("=");c[0]=c[0].trim();b+=c[0];1<c.length&&
(x[h]&&!q&&x[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();!l.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})&&"undefined"!==typeof b[1]&&(q+="var "+b[0]+" = "+b[1]+";",I[e][b[0]]=a)}),c[1]=c[1].trim(),q+=c[0]+" = typeof "+c[0]+" !== 'undefined' && "+c[0]+" !== null ? "+c[0]+" : "+c[1]+";");I[e][c[0]]=a;d!==l.length-1&&(b+=",")});b+=") { "+q+"var __SNAKESKIN_RESULT__ = '', __SNAKESKIN_TMP_RESULT__;";break;case "if":m++;
!h&&!s&&(b+="if ("+f.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":!h&&!s&&(b+="} else if ("+f.replace(/^elseIf\s+/,"")+") {");break;case "else":!h&&!s&&(b+="} else {");break;case "with":C.push({scope:f.replace(/^with\s+/,""),i:++m});break;case "proto":if(!d&&(h&&!r.length&&!y.length||!h)){if(w[e][f])throw k=Error('Proto "'+f.replace(/^proto\s+/,"")+'" is already defined (command: {'+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;w[e][f]={from:p-v+1}}y.push({name:f,
i:++m,startI:p+1});h||(s=!0);break;case "apply":!h&&!y.length&&(f=f.replace(/^apply/,"proto"),w[e][f]?b+=w[e][f].body:(B[f]||(B[f]=[],B[f].protoStart=s,S=f.replace(/^proto\s+/,""),Q++),B[f].push(b.length)));break;case "block":if(!d&&(h&&!r.length&&!y.length||!h)){if(D[e][f])throw k=Error('Block "'+f.replace(/^block\s+/,"")+'" is already defined (command: {'+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;D[e][f]={from:p-v+1}}r.push({name:f,i:++m});break;case "forEach":K.push(++m);
!h&&!s&&(f=f.replace(/^forEach\s+/,"").split("=>"),b+=f[0]+" && Snakeskin.forEach("+f[0]+", function ("+(f[1]||"")+") {");break;case "end":m--;j=r[r.length-1];u=y[y.length-1];J=C[C.length-1];T=K[K.length-1];if(0===m){if(Q)throw k=Error('Proto "'+S+'" is not defined (command: {'+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;if(d)break;H[e]=a.substring(v,p-f.length-1);if(h){a=a.substring(0,v)+this._getExtStr(e,g)+a.substring(p-f.length-1);D[e]={};w[e]={};L[e]=0;E[e]=
{};M[e]=0;I[e]={};p=v-1;m++;A=n=h=!1;f="";continue}b+="return __SNAKESKIN_RESULT__; }; Snakeskin.cache['"+e+"'] = "+(c?"exports.":"")+e+";";e=null}else if(!h&&(!u||u.i!==m+1)&&(!j||j.i!==m+1)&&(!J||J.i!==m+1))T===m+1?(K.pop(),s||(b+="});")):s||(b+="};");if(j&&j.i===m+1&&(r.pop(),!d&&(h&&!r.length&&!y.length||!h)))D[e][j.name].to=p-v-f.length-1;if(u&&u.i===m+1){y.pop();if(!d&&(h&&!r.length&&!y.length||!h))w[e][u.name].to=p-v-f.length-1,L[e]=p-v+1;h||(w[e][u.name].body=this.compile("{template "+e+"()}"+
a.substring(u.startI,p-f.length-1)+"{end}",null,!0));B[u.name]&&!B[u.name].protoStart&&(B[u.name].forEach(function(a){b=b.substring(0,a)+w[e][u.name].body+b.substring(a)}),delete B[u.name],Q--);y.length||(s=!1)}J&&J.i===m+1&&C.pop();break;default:if(!h&&!s&&/console\./.test(f)){b+=f+";";break}if(/=(?!=)/.test(f)){t=f.split("=")[0].trim();if(E[e][t]||I[e][t])throw k=Error('Variable "'+t+'" is already defined (command: {'+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;
if(fa[t])throw k=Error("Can't declare variable \""+t+'", try another name (command: {'+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;if(K.length)throw k=Error('Variable "'+t+"\" can't be defined in a loop (command: {"+f+'}, template: "'+e+", "+this._genError(g)+'")!'),k.name="Snakeskin Error",k;E[e][t]={from:p-v-f.length,to:p-v};M[e]=p-v+1;!h&&!s&&(b+="var "+f+";")}else!h&&!s&&(t="",V=1,O=!1,f.split("|").forEach(function(a,b){var c,d;0===b?C.length?(C.push({scope:a}),
t=C.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),C.pop()):t=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(V++,t="Snakeskin.Filters['"+c[0]+"']("+t+(d.length?", "+d.join(""):"")+")"):O=!0)}),b+="__SNAKESKIN_TMP_RESULT__ = "+(!O?"Snakeskin.Filters.html(":"")+t+(!O?")":"")+";",b+="__SNAKESKIN_RESULT__ += typeof __SNAKESKIN_TMP_RESULT__ === 'undefined' ? '' : __SNAKESKIN_TMP_RESULT__;")}f="";continue}if(n){!s&&A&&(b+="';",A=!1);if((R[j]||"/"===j)&&(!a[p-1]||"\\"!==
a[p-1]))F&&F===j?F=!1:F||(F=j);f+=j}else s||(A||(b+="__SNAKESKIN_RESULT__ += '",A=!0),h||(b+=j))}b=this._descape(b).replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return P[b].replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\v/gm,"\\v").replace(/\'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");b+=!d?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";b+=c?"}":"";if(0!==m)throw k=Error("Missing closing or opening tag in the template (template: "+e+", "+
this._genError(g)+")!"),k.name="Snakeskin Error",k;if(d)return b;G?c?eval(b):global.eval(b):window.eval(b);return b};if(G)for(z in Snakeskin)Snakeskin.hasOwnProperty(z)&&(exports[z]=Snakeskin[z])})("undefined"===typeof window);
