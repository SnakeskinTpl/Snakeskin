var Snakeskin={Filters:{}};(function(){Snakeskin.forEach=function(g,q){var h=-1,j,t;if(Array.isArray(g))for(j=g.length;++h<j;)q(g[h],h,0===h,h===j-1,j);else{h=0;for(t in g)g.hasOwnProperty(t)&&h++;j=h;h=-1;for(t in g)g.hasOwnProperty(t)&&(h++,q(g[t],t,h,0===h,h===j-1,j))}};var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},y=/[&<>"'\/]/g,w=function(g){return E[g]};Snakeskin.Filters.html=function(g){return String(g).replace(y,w)}})();
(function(E){var y={},w={},g={},q={},h={},j=[],t={'"':!0,"'":!0};Snakeskin._getExtStr=function(k){for(var d=y[h[k]],f=d.length,e,l=w[k],m=w[h[k]],n,c,p=-1,j=0;4>++p;)for(c in 1<p&&(l=g[k],m=g[h[k]],f=d.length),l)l.hasOwnProperty(c)&&(e=d.length-f,n=y[k].substring(l[c].from,l[c].to),m[c]&&(0===p||2===p)?(1<p&&(j=m[c].from+e+n.length+1),d=d.substring(0,m[c].from+e)+n+d.substring(m[c].to+e,d.length)):m[c]||(1===p?d+="{"+c+"}"+n+"{/end}":3===p&&(n="{"+n+"}",d=d.substring(0,j)+n+d.substring(j,d.length),
j+=n.length)));return d};Snakeskin.compile=function(k){k=(k.innerHTML||k).replace(/{cdata}([\s\S]*?){\/cdata}/,function(a,b){j.push(b);return"@cdata_"+(j.length-1)}).replace(/\/\/.*/g,"").replace(/^\s*|\s*$/g,"").replace(/{\/end}\s*{template/g,"{/end}{template").replace(/[\t]/g,"").replace(/[\n\r]/g,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var d,f,e,l,m,n,c=0,p,B=[],u=[],z,C=[],F,b="",D,r,G,a="/* This code is generated automatically, don't alter it. */",s=-1,A,v;++s<k.length;)if(d=k.charAt(s),"{"===
d)n=!0;else if("}"===d){n=!1;switch(b.split(" ")[0]){case "template":c++;f=b.replace(/^template\s+/,"").replace(/\(.*/,"");l=b.replace(/.*?\((.*?)\).*/,"$1");w[f]={};g[f]={};/\s+extends\s+/.test(b)&&(e=b.replace(/.*?\s+extends\s+(.*)/,"$1"));h[f]=e;a+="/* Snakeskin template: "+f+"; "+l.replace(/=(.*?)(?:,|$)/g,"")+" */";a=/\./.test(f)?a+(f+"= function ("):a+("function "+f+"(");v=s+1;l=l.split(",");q[f]=q[e]?q[e].concat(l):l;m="";q[e]&&q[e].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=
b[1]&&b[1].trim();l.forEach(function(d,c){var x=d.split("=");x[0]=x[0].trim();x[1]=x[1]&&x[1].trim();b[0]===x[0]&&"undefined"===typeof x[1]&&(l[c]=a)})});l.forEach(function(b,d){var c=b.split("=");c[0]=c[0].trim();a+=c[0];1<c.length&&(q[e]&&!m&&q[e].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();l.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})||(m="undefined"!==typeof b[1]?m+("var "+b[0]+" = typeof "+b[0]+" !== 'undefined' && "+
b[0]+" !== null ? "+b[0]+" : "+b[1]+";"):m+("var "+b[0]+";"))}),c[1]=c[1].trim(),m+=c[0]+" = typeof "+c[0]+" !== 'undefined' && "+c[0]+" !== null ? "+c[0]+" : "+c[1]+";");d!==l.length-1&&(a+=",")});a+=") { "+m+"var __RESULT__ = '';";break;case "if":c++;e||(a+="if ("+b.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":e||(a+="} else if ("+b.replace(/^elseIf\s+/,"")+") {");break;case "else":e||(a+="} else {");break;case "with":u.push({scope:b.replace(/^with\s+/,""),i:++c});break;case "block":w[f][b]=
{from:s-v+1};B.push({name:b,i:++c});break;case "forEach":C.push(++c);e||(d=b.replace(/^forEach\s+/,"").split("=>"),a+=d[0]+" && Snakeskin.forEach("+d[0]+", function ("+(d[1]||"")+") {");break;case "/end":c--;d=B[B.length-1];z=u[u.length-1];F=C[C.length-1];if(0===c){y[f]=k.substring(v,s-b.length-1);if(e){k=k.substring(0,v)+this._getExtStr(f)+k.substring(s-b.length-1,k.length);g[f]={};s=v-1;c++;p=n=e=!1;b="";continue}a+="return __RESULT__; };"}else if(!e&&(!d||d.i!==c+1)&&(!z||z.i!==c+1))F===c+1?(C.pop(),
a+="});"):a+="};";d&&d.i===c+1&&(w[f][d.name].to=s-v-b.length-1,B.pop());z&&z.i===c+1&&u.pop();break;default:if(!e&&/console\./.test(b)){a+=b+";";break}if(/=(?!=)/.test(b)){r=b.split("=")[0].trim();if(g[f][r])throw Error('Variable "'+r+'" has already defined (template: "'+f+'")!');g[f][r]={from:s-v-b.length,to:s-v};e||(a+="var "+b+";")}else e||(r="",G=1,D=A=!1,b=b.split(""),b.forEach(function(a,c){if(t[a]){if(!b[c-1]||"\\"!==b[c-1])A=A&&A===a?!1:a}else"|"===a&&A&&(b[c]="__SNAKESKIN_ESCAPE__PIPE")}),
b=b.join(""),b.split("|").forEach(function(a,b){var c,d;0===b?u.length?(u.push({scope:a}),r=u.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),u.pop()):r=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(G++,r="Snakeskin.Filters['"+c[0]+"']("+r+(d.length?", "+d.join(""):"")+")"):D=!0)}),a+="__RESULT__ += "+(!D?"Snakeskin.Filters.html(":"")+r.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|")+(!D?")":"")+";")}b=""}else n?(p&&(a+="';",p=!1),b+=d):(p||(a+="__RESULT__ += '",p=!0),
e||(a+=d));a=a.replace(/@cdata_(\d+)/g,function(a,b){return j[b].replace(/[\n\r]/g,"").replace(/\'/g,"&#39;")}).replace(/__RESULT__ \+= '';/g,"");a+="/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */";if(0!==c)throw Error("Missing closing or opening tag in the template!");E.eval(a)}})(window||global);
