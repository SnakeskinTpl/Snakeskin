var Snakeskin={VERSION:"1.1",Filters:{},cache:{}},SS=Snakeskin;
(function(F){var z;Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});Snakeskin.forEach=function(a,c){var d=-1,b,h;if(Array.isArray(a))for(b=a.length;++d<b;)c(a[d],d,0===d,d===b-1,b);else{d=0;for(h in a)a.hasOwnProperty(h)&&d++;b=d;d=-1;for(h in a)a.hasOwnProperty(h)&&(d++,c(a[h],h,d,0===d,d===b-1,b))}};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},O=/[&<>"'\/]/g,P=function(a){return N[a]};Snakeskin.Filters.html=
function(a){return String(a).replace(O,P)};Array.prototype.forEach||(Array.prototype.forEach=function(a,c){var d=-1,b=this.length;if(c)for(;(d+=1)<b;)a.call(c,this[d],d,this);else for(;(d+=1)<b;)a(this[d],d,this)});Array.prototype.some||(Array.prototype.some=function(a,c){var d=-1,b=this.length,h;if(c)for(;(d+=1)<b;){if(h=a.call(c,this[d],d,this))return!0}else for(;(d+=1)<b;)if(h=a(this[d],d,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(a,c){var d=0,b=this.length,
h;if(1===b)return this[0];for(h="undefined"!==typeof c?c:this[0];(d+=1)<b;)h=a(h,this[d],d,this);return h});String.prototype.trim||(String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),c=a.length;/\s/.test(a.charAt(c-=1)););return a.substring(0,c+1)});var I={},A={},u={},D={},J={},B={},C={},L=[],Q={'"':!0,"'":!0},R={template:!0,"if":!0,elseIf:!0,"else":!0,"with":!0,forEach:!0,block:!0,proto:!0,apply:!0,__SNAKESKIN_RESULT__:!0,__SNAKESKIN_TMP_RESULT__:!0,__SNAKESKIN_CDATA__:!0},k;Snakeskin._getExtStr=
function(a){if(!I[C[a]])throw k=Error('The specified pattern ("'+C[a]+'" for "'+a+'") for inheritance is not defined!'),k.name="Snakeskin Error",k;for(var c=I[C[a]],d,b,h,e,g,j,l,p=-1,n=0,m=[],t;6>++p;)for(l in 0===p%2&&(d=c.length),0===p?(e=A[a],g=A[C[a]]):2===p?(e=D[a],g=D[C[a]],n=0):4===p&&(e=u[a],g=u[C[a]],n=0),e)e.hasOwnProperty(l)&&(h=c.length-d,t=0,j=I[a].substring(e[l].from,e[l].to),g[l]&&0===p%2?(1<p&&(n=g[l].from+h+j.length+1),4===p&&(b=g[l].from+h,m.some(function(a){if(a.val<b)t=a.adv;
else return!0}),n+=t+4),c=c.substring(0,g[l].from+h+t)+j+c.substring(g[l].to+h+t,c.length)):g[l]||(1===p?c+="{"+l+"}"+j+"{end}":3===p?(j="{"+j+"}",c=c.substring(0,n)+j+c.substring(n,c.length),m.push({val:n,adv:n+j.length}),n+=j.length):5===p&&(j="{"+l+"}"+j+"{end}",c=c.substring(0,n)+j+c.substring(n,c.length),n+=j.length)));return c};Snakeskin._escape=function(a){var c;a=a.split("");a.forEach(function(d,b){if(Q[d]){if(!a[b-1]||"\\"!==a[b-1])c=c&&c===d?!1:d}else if(c)switch(d){case "|":a[b]="__SNAKESKIN_ESCAPE__PIPE";
break;case "=":a[b]="__SNAKESKIN_ESCAPE__EQUAL";break;case ",":a[b]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":a[b]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":a[b]="__SNAKESKIN_ESCAPE__BCLOSE"}});return a=a.join("")};Snakeskin._descape=function(a){return a.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,")")};Snakeskin.compile=function(a,c,d){a=
(a.innerHTML||a).replace(/{cdata}([\s\S]*?){end\s+cdata}/,function(b,a){L.push(a);return"__SNAKESKIN_CDATA__"+(L.length-1)}).replace(/\/\/.*/g,"").replace(/^\s*|\s*$/g,"").replace(/{end}\s*{template/g,"{end}{template").replace(/[\t]/g,"").replace(/[\n\r]/g,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var b=""+(!d?"/* This code is generated automatically, don't alter it. */":"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);return this;};":""),h,e,g,
j,l,p,n=0,m=0,t,E=[],w=[],x,s,y=[],G,H=[],z,f="",K,q,M,r=-1,v;++r<a.length;){h=a.charAt(r);if("{"===h)if(p)n++;else{p=!0;continue}else if("}"===h&&(!n||!n--)){p=!1;f=this._escape(f);switch(f.split(" ")[0]){case "template":m++;v=r+1;e=f.replace(/^template\s+/,"").replace(/\(.*/,"");if(d)break;/\s+extends\s+/.test(f)&&(g=f.replace(/.*?\s+extends\s+(.*)/,"$1"));j=f.replace(/.*?\((.*?)\).*/,"$1");A[e]={};u[e]={};D[e]={};J[e]={};C[e]=g;b+="/* Snakeskin template: "+e+"; "+j.replace(/=(.*?)(?:,|$)/g,"")+
" */";/\./.test(e)||c?(e.split(".").reduce(function(a,d,e){b+="if (typeof "+(c?"exports.":"")+a+" === 'undefined') { "+(c?"exports.":1===e?F?"var ":"window.":"")+a+" = {}; }";return a+"."+d}),b+=(c?"exports.":"")+e+"= function ("):b+=(!F?"window."+e+" = ":"")+"function "+(F?e:"")+"(";j=j.split(",");B[e]=B[g]?B[g].concat(j):j;l="";B[g]&&B[g].forEach(function(b){var a=b.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();j.forEach(function(d,e){var c=d.split("=");c[0]=c[0].trim();c[1]=c[1]&&c[1].trim();
a[0]===c[0]&&"undefined"===typeof c[1]&&(j[e]=b)})});j.forEach(function(a,d){var c=a.split("=");c[0]=c[0].trim();b+=c[0];1<c.length&&(B[g]&&!l&&B[g].forEach(function(b){var a=b.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();j.some(function(b){b=b.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();return b[0]===a[0]})||(l="undefined"!==typeof a[1]?l+("var "+a[0]+" = typeof "+a[0]+" !== 'undefined' && "+a[0]+" !== null ? "+a[0]+" : "+a[1]+";"):l+("var "+a[0]+";"))}),c[1]=c[1].trim(),J[e][c[0]]=
a,l+=c[0]+" = typeof "+c[0]+" !== 'undefined' && "+c[0]+" !== null ? "+c[0]+" : "+c[1]+";");d!==j.length-1&&(b+=",")});b+=") { "+l+"var __SNAKESKIN_RESULT__ = '', __SNAKESKIN_TMP_RESULT__;";break;case "if":m++;!g&&!s&&(b+="if ("+f.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":!g&&!s&&(b+="} else if ("+f.replace(/^elseIf\s+/,"")+") {");break;case "else":!g&&!s&&(b+="} else {");break;case "with":y.push({scope:f.replace(/^with\s+/,""),i:++m});break;case "proto":if(!d&&(g&&!w.length||!g)){if(u[e][f])throw k=
Error('Proto "'+f.replace(/^proto\s+/,"")+'" is already defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;u[e][f]={from:r-v+1}}w.push({name:f,i:++m,startI:r+1});g||(s=!0);break;case "apply":if(!g&&!w.length){f=f.replace(/^apply/,"proto");if(!u[e][f])throw k=Error('Proto "'+f.replace(/^proto\s+/,"")+'" is not defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;b+=u[e][f.replace(/^apply/,"proto")].body}break;case "block":if(!d&&(g&&!E.length||!g)){if(A[e][f])throw k=Error('Block "'+f.replace(/^block\s+/,
"")+'" is already defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;A[e][f]={from:r-v+1}}E.push({name:f,i:++m});break;case "forEach":H.push(++m);!g&&!s&&(f=f.replace(/^forEach\s+/,"").split("=>"),b+=f[0]+" && Snakeskin.forEach("+f[0]+", function ("+(f[1]||"")+") {");break;case "end":m--;h=E[E.length-1];x=w[w.length-1];G=y[y.length-1];z=H[H.length-1];if(0===m){if(d)break;I[e]=a.substring(v,r-f.length-1);if(g){a=a.substring(0,v)+this._getExtStr(e)+a.substring(r-f.length-1,a.length);A[e]={};
u[e]={};D[e]={};J[e]={};r=v-1;m++;t=p=g=!1;f="";continue}b+="return __SNAKESKIN_RESULT__; }; Snakeskin.cache['"+e+"'] = "+(c?"exports.":"")+e+";"}else if(!g&&(!x||x.i!==m+1)&&(!h||h.i!==m+1)&&(!G||G.i!==m+1))z===m+1?(H.pop(),s||(b+="});")):s||(b+="};");if(h&&h.i===m+1&&(E.pop(),!d&&(g&&!E.length||!g)))A[e][h.name].to=r-v-f.length-1;if(x&&x.i===m+1){w.pop();if(!d&&(g&&!w.length||!g))u[e][x.name].to=r-v-f.length-1;g||(u[e][x.name].body=this.compile("{template "+e+"()}"+a.substring(x.startI,r-f.length-
1)+"{end}",null,!0));w.length||(s=!1)}G&&G.i===m+1&&y.pop();break;default:if(!g&&!s&&/console\./.test(f)){b+=f+";";break}if(/=(?!=)/.test(f)){q=f.split("=")[0].trim();if(D[e][q]||J[e][q])throw k=Error('Variable "'+q+'" is already defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;if(R[q])throw k=Error("Can't declare variable \""+q+'", try another name (template: "'+e+'")!'),k.name="Snakeskin Error",k;if(H.length)throw k=Error('Variable "'+q+'" can\'t be defined in a loop (template: "'+e+'")!'),
k.name="Snakeskin Error",k;D[e][q]={from:r-v-f.length,to:r-v};!g&&!s&&(b+="var "+f+";")}else!g&&!s&&(q="",M=1,K=!1,f.split("|").forEach(function(a,b){var c,d;0===b?y.length?(y.push({scope:a}),q=y.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),y.pop()):q=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(M++,q="Snakeskin.Filters['"+c[0]+"']("+q+(d.length?", "+d.join(""):"")+")"):K=!0)}),b+="__SNAKESKIN_TMP_RESULT__ = "+(!K?"Snakeskin.Filters.html(":"")+q+(!K?")":"")+
";",b+="__SNAKESKIN_RESULT__ += typeof __SNAKESKIN_TMP_RESULT__ === 'undefined' ? '' : __SNAKESKIN_TMP_RESULT__;")}f="";continue}p?(!s&&t&&(b+="';",t=!1),f+=h):s||(t||(b+="__SNAKESKIN_RESULT__ += '",t=!0),g||(b+=h))}b=this._descape(b).replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return L[b].replace(/[\n\r]/g,"").replace(/\'/g,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");b+=!d?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";if(0!==m)throw k=Error("Missing closing or opening tag in the template!"),
k.name="Snakeskin Error",k;if(d)return b;F?c?eval(b):global.eval(b):window.eval(b);return b};if(F)for(z in Snakeskin)Snakeskin.hasOwnProperty(z)&&(exports[z]=Snakeskin[z])})("undefined"===typeof window);
