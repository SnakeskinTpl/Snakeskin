var Snakeskin={VERSION:"1.0.1",Filters:{}};
(function(u){var p;Array.isArray||(Array.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)});Snakeskin.forEach=function(d,c){var b=-1,a,f;if(Array.isArray(d))for(a=d.length;++b<a;)c(d[b],b,0===b,b===a-1,a);else{b=0;for(f in d)d.hasOwnProperty(f)&&b++;a=b;b=-1;for(f in d)d.hasOwnProperty(f)&&(b++,c(d[f],f,b,0===b,b===a-1,a))}};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},J=/[&<>"'\/]/g,K=function(d){return I[d]};Snakeskin.Filters.html=
function(d){return String(d).replace(J,K)};Array.prototype.forEach||(Array.prototype.forEach=function(d,c){var b=-1,a=this.length;if(c)for(;(b+=1)<a;)d.call(c,this[b],b,this);else for(;(b+=1)<a;)d(this[b],b,this)});Array.prototype.some||(Array.prototype.some=function(d,c){var b=-1,a=this.length,f;if(c)for(;(b+=1)<a;){if(f=d.call(c,this[b],b,this))return!0}else for(;(b+=1)<a;)if(f=d(this[b],b,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(d,c){var b=0,a=this.length,
f;if(1===a)return this[0];for(f="undefined"!==typeof c?c:this[0];(b+=1)<a;)f=d(f,this[b],b,this);return f});String.prototype.trim||(String.prototype.trim=function(){for(var d=this.replace(/^\s\s*/,""),c=d.length;/\s/.test(d.charAt(c-=1)););return d.substring(0,c+1)});var D={},v={},t={},E={},s={},A={},F=[],L={'"':!0,"'":!0};Snakeskin._getExtStr=function(d){for(var c=D[A[d]],b=c.length,a,f=v[d],g=v[A[d]],h,e,j=-1,k=0;4>++j;)for(e in 1<j&&(f=t[d],g=t[A[d]],b=c.length),f)f.hasOwnProperty(e)&&(a=c.length-
b,h=D[d].substring(f[e].from,f[e].to),g[e]&&(0===j||2===j)?(1<j&&(k=g[e].from+a+h.length+1),c=c.substring(0,g[e].from+a)+h+c.substring(g[e].to+a,c.length)):g[e]||(1===j?c+="{"+e+"}"+h+"{/end}":3===j&&(h="{"+h+"}",c=c.substring(0,k)+h+c.substring(k,c.length),k+=h.length)));return c};Snakeskin._escape=function(d){var c;d=d.split("");d.forEach(function(b,a){if(L[b]){if(!d[a-1]||"\\"!==d[a-1])c=c&&c===b?!1:b}else if(c)switch(b){case "|":d[a]="__SNAKESKIN_ESCAPE__PIPE";break;case "=":d[a]="__SNAKESKIN_ESCAPE__EQUAL";
break;case ",":d[a]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":d[a]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":d[a]="__SNAKESKIN_ESCAPE__BCLOSE"}});return d=d.join("")};Snakeskin._descape=function(d){return d.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,")")};Snakeskin.compile=function(d,c){var b=(d.innerHTML||d).replace(/{cdata}([\s\S]*?){\/cdata}/,
function(a,b){F.push(b);return"@cdata_"+(F.length-1)}).replace(/\/\/.*/g,"").replace(/^\s*|\s*$/g,"").replace(/{\/end}\s*{template/g,"{/end}{template").replace(/[\t]/g,"").replace(/[\n\r]/g,"").replace(/\/\*[\s\S]*?\*\//g,""),a="/* This code is generated automatically, don't alter it. */"+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);return this;};":""),f,g,h,e,j,k,w,p=0,l=0,x,B=[],q=[],y,z=[],G;e="";for(var C,m,H,n=-1,r;++n<b.length;){f=b.charAt(n);
if("{"===f)if(w)p++;else{w=!0;continue}else if("}"===f&&(!p||!p--)){w=!1;e=this._escape(e);switch(e.split(" ")[0]){case "template":l++;g=e.replace(/^template\s+/,"").replace(/\(.*/,"");/\s+extends\s+/.test(e)&&(h=e.replace(/.*?\s+extends\s+(.*)/,"$1"));j=e.replace(/.*?\((.*?)\).*/,"$1");v[g]={};t[g]={};E[g]={};A[g]=h;a+="/* Snakeskin template: "+g+"; "+j.replace(/=(.*?)(?:,|$)/g,"")+" */";/\./.test(g)||c?(g.split(".").reduce(function(b,d,e){a+="if (typeof "+(c?"exports.":"")+b+" === 'undefined') { "+
(c?"exports.":1===e?u?"var ":"window.":"")+b+" = {}; }";return b+"."+d}),a+=(c?"exports.":"")+g+"= function ("):a+=(!u?"window."+g+" = ":"")+"function "+(u?g:"")+"(";r=n+1;j=j.split(",");s[g]=s[h]?s[h].concat(j):j;k="";s[h]&&s[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();j.forEach(function(d,e){var c=d.split("=");c[0]=c[0].trim();c[1]=c[1]&&c[1].trim();b[0]===c[0]&&"undefined"===typeof c[1]&&(j[e]=a)})});j.forEach(function(b,d){var c=b.split("=");c[0]=c[0].trim();
a+=c[0];1<c.length&&(s[h]&&!k&&s[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();j.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})||(k="undefined"!==typeof b[1]?k+("var "+b[0]+" = typeof "+b[0]+" !== 'undefined' && "+b[0]+" !== null ? "+b[0]+" : "+b[1]+";"):k+("var "+b[0]+";"))}),c[1]=c[1].trim(),E[g][c[0]]=b,k+=c[0]+" = typeof "+c[0]+" !== 'undefined' && "+c[0]+" !== null ? "+c[0]+" : "+c[1]+";");d!==j.length-1&&(a+=",")});
a+=") { "+k+"var __RESULT__ = '';";break;case "if":l++;h||(a+="if ("+e.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":h||(a+="} else if ("+e.replace(/^elseIf\s+/,"")+") {");break;case "else":h||(a+="} else {");break;case "with":q.push({scope:e.replace(/^with\s+/,""),i:++l});break;case "block":v[g][e]={from:n-r+1};B.push({name:e,i:++l});break;case "forEach":z.push(++l);h||(e=e.replace(/^forEach\s+/,"").split("=>"),a+=e[0]+" && Snakeskin.forEach("+e[0]+", function ("+(e[1]||"")+") {");break;case "/end":l--;
f=B[B.length-1];y=q[q.length-1];G=z[z.length-1];if(0===l){D[g]=b.substring(r,n-e.length-1);if(h){b=b.substring(0,r)+this._getExtStr(g)+b.substring(n-e.length-1,b.length);t[g]={};n=r-1;l++;x=w=h=!1;e="";continue}a+="return __RESULT__; };"}else if(!h&&(!f||f.i!==l+1)&&(!y||y.i!==l+1))G===l+1?(z.pop(),a+="});"):a+="};";f&&f.i===l+1&&(v[g][f.name].to=n-r-e.length-1,B.pop());y&&y.i===l+1&&q.pop();break;default:if(!h&&/console\./.test(e)){a+=e+";";break}if(/=(?!=)/.test(e)){m=e.split("=")[0].trim();if(t[g][m]||
E[g][m]||"__RESULT__"===m)throw Error('Variable "'+m+'" has already defined (template: "'+g+'")!');if(z.length)throw Error('Variable "'+m+'" can\'t be defined in a loop (template: "'+g+'")!');t[g][m]={from:n-r-e.length,to:n-r};h||(a+="var "+e+";")}else h||(m="",H=1,C=!1,e.split("|").forEach(function(a,b){var c,d;0===b?q.length?(q.push({scope:a}),m=q.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),q.pop()):m=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(H++,m="Snakeskin.Filters['"+
c[0]+"']("+m+(d.length?", "+d.join(""):"")+")"):C=!0)}),a+="__RESULT__ += "+(!C?"Snakeskin.Filters.html(":"")+m+(!C?")":"")+";")}e="";continue}w?(x&&(a+="';",x=!1),e+=f):(x||(a+="__RESULT__ += '",x=!0),h||(a+=f))}a=this._descape(a).replace(/@cdata_(\d+)/g,function(a,b){return F[b].replace(/[\n\r]/g,"").replace(/\'/g,"&#39;")}).replace(/__RESULT__ \+= '';/g,"");a+="/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */";if(0!==l)throw Error("Missing closing or opening tag in the template!");
u?c?eval(a):global.eval(a):window.eval(a);return a};if(u)for(p in Snakeskin)Snakeskin.hasOwnProperty(p)&&(exports[p]=Snakeskin[p])})("undefined"===typeof window);
