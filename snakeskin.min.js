var Snakeskin={VERSION:"2.0",Directions:{},Filters:{},BEM:{},Vars:{},write:{},cache:{}},SS=Snakeskin;
(function(u){Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});String.prototype.trim||(String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),c=a.length;/\s/.test(a.charAt(--c)););return a.substring(0,c+1)});Snakeskin.forEach=function(a,c){var b=-1,e,d;if(Array.isArray(a))for(e=a.length;++b<e&&!1!==c(a[b],b,0===b,b===e-1,e););else{b=0;for(d in a)a.hasOwnProperty(d)&&b++;e=b;b=-1;for(d in a)if(a.hasOwnProperty(d)&&(b++,!1===c(a[d],
d,b,0===b,b===e-1,e)))break}};var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},F=/[&<>"'\/]/g,G=function(a){return E[a]};Snakeskin.Filters.html=function(a){return String(a).replace(F,G)};Snakeskin.Filters.undef=function(a){return"undefined"!==typeof a?a:""};var H={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"},I=/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,J=function(a){return H[a]};Snakeskin.Filters.uhtml=function(a){return String(a).replace(I,J)};
var K=/<\/?[^>]+>/g;Snakeskin.Filters.stripTags=function(a){return String(a).replace(K,"")};var L=/%5B/g,M=/%5D/g;Snakeskin.Filters.uri=function(a){return encodeURI(String(a)).replace(L,"[").replace(M,"]")};Snakeskin.Filters.upper=function(a){return String(a).toUpperCase()};Snakeskin.Filters.ucfirst=function(a){a=String(a);return a.charAt(0).toUpperCase()+a.substring(1)};Snakeskin.Filters.lower=function(a){return String(a).toLowerCase()};Snakeskin.Filters.lcfirst=function(a){a=String(a);return a.charAt(0).toLowerCase()+
a.substring(1)};Snakeskin.Filters.trim=function(a){return String(a).trim()};var N=/\s{2,}/g;Snakeskin.Filters.collapse=function(a){return String(a).replace(N," ").trim()};Snakeskin.Filters.truncate=function(a,c,b){a=String(a);if(!a||a.length<=c)return a;a=a.substring(0,c-1);var e;for(c=a.length;c--&&b;)if(" "===a.charAt(c))e=c;else if("undefined"!==typeof e)break;return("undefined"!==typeof e?a.substring(0,e):a)+"\u2026"};Snakeskin.Filters.repeat=function(a,c){return Array(c||2).join(a)};Snakeskin.Filters.remove=
function(a,c){return String(a).replace(c,"")};Snakeskin.Filters.replace=function(a,c,b){return String(a).replace(c,b)};Array.prototype.reduce||(Array.prototype.reduce=function(a,c){var b=0,e=this.length,d;if(1===e)return this[0];for(d="undefined"!==typeof c?c:this[0];++b<e;)d=a(d,this[b],b,this);return d});var s={},n={},l={},v={},C={},p={},w={},t={},q={},x={},z=[],O={'"':!0,"'":!0},P={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_CDATA__:!0};Snakeskin._escape=function(a,c){return a.replace(/(["']).*?[^\\]\1/g,
function(b){c&&c.push(b);return"__SNAKESKIN_QUOT__"+(c?c.length-1:"_")})};Snakeskin._uescape=function(a,c){return a.replace(/__SNAKESKIN_QUOT__(\d+)/g,function(b,a){return c[a]})};Snakeskin._getExtStr=function(a,c){if("undefined"===typeof s[x[a]])throw this.error('The specified pattern ("'+x[a]+'" for "'+a+'") for inheritance is not defined ('+this._genErrorAdvInfo(c)+")!");for(var b=x[a],e=s[b],d,g,h,f,j=-1,m,k=0,A=[],B,D,r;6>++j;)for(f in 0===j?(d=n[a],g=n[b]):2===j?(d=p[a],g=p[b],k=w[b],m=null):
4===j&&(d=l[a],g=l[b],k=v[b],m=null),d)if(d.hasOwnProperty(f))if(r=0,h=s[a].substring(d[f].from,d[f].to),g[f]&&(B=h.length-s[b].substring(g[f].from,g[f].to).length),D=g[f]?g[f].from:k,A.sort(function(b,a){if(b.val>a.val)return 1;if(b.val===a.val)return 0;if(b.val<a.val)return-1}).some(function(b){if(b.val<D)r+=b.adv;else return!0}),g[f]&&0===j%2)1<j&&(m=g[f].from+r+h.length,k+=B,m>k&&(k=m+(4===j?5:1))),e=e.substring(0,g[f].from+r)+h+e.substring(g[f].to+r),A.push({val:g[f].from,adv:B});else if(!g[f])if(1===
j)e+="{"+f+"}"+h+"{end}";else if(3===j||5===j)null===m&&(m=k,k+=r),h=3===j?"{"+h+"}":"{"+f+"}"+h+"{end}",e=e.substring(0,k)+h+e.substring(k),A.push({val:m,adv:h.length}),k+=h.length;return e};Snakeskin._genErrorAdvInfo=function(a){var c,b="";for(c in a)a.hasOwnProperty(c)&&(b=a[c].innerHTML?b+(c+": (class: "+(a[c].className||"undefined")+", id: "+(a[c].id||"undefined")+"), "):b+(c+": "+a[c]+", "));return b.replace(/, $/,"")};Snakeskin.error=function(a){a=Error(a);a.name="Snakeskin Error";return a};
Snakeskin.compile=function(a,c,b,e){e=e||{};a.innerHTML&&(e.node=a);a={i:-1,beginI:0,nmCache:{},posCache:{},sysPosCache:{},backHashI:0,backHash:{},lastBack:null,quotContent:[],source:String(a.innerHTML||a).replace(/{cdata}([\s\S]*?){end\s+cdata}/gm,function(b,a){z.push(a);return"__SNAKESKIN_CDATA__"+(z.length-1)}).replace(/\/\/.*/gm,"").replace(/[\t\v\r\n]/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),res:""+(!b?"/* This code is generated automatically, don't alter it. */":"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);exec();return this;};function exec() {":
""),save:function(b){this.canWrite&&(this.res+=b)},replace:function(b){this.canWrite&&(this.res=b)},setPos:function(b,a,c){c?(this.sysPosCache[b]||(this.sysPosCache[b]=[]),this.sysPosCache[b].push(a)):(this.posCache[b]||(this.posCache[b]=[]),this.posCache[b].push(a))},hasPos:function(b,a){return a?!(!this.sysPosCache[b]||!this.sysPosCache[b].length):!(!this.posCache[b]||!this.posCache[b].length)},getLastPos:function(b,a){if(a){if(this.sysPosCache[b]&&this.sysPosCache[b].length)return this.sysPosCache[b][this.sysPosCache[b].length-
1]}else if(this.posCache[b]&&this.posCache[b].length)return this.posCache[b][this.posCache[b].length-1]},notSysPos:function(b){var a=this,c=!0;Snakeskin.forEach(this.sysPosCache,function(d,j){if((d=a.getLastPos(j,!0))&&("undefined"!==typeof d.i&&d.i===b||d===b))return c=!1});return c}};for(var d,g=0,h,f="",j,m,k;++a.i<a.source.length;){j=a.source.charAt(a.i);if(!k)if("{"===j)if(d)g++;else{d=!0;continue}else if("}"===j&&(!g||!g--)){d=!1;m=f.length;f=this._escape(f,a.quotContent).trim();j=f.split(" ")[0];
j=this.Directions[j]?j:"const";f=this.Directions[j].call(this,"const"!==j?f.replace(RegExp("^"+j+"\\s+"),""):f,m,a,{commonJS:c,dryRun:b,info:e});!1===f&&(h=d=!1);f="";continue}if(d){!a.protoStart&&h&&(a.save("';"),h=!1);if((O[j]||"/"===j)&&(!a.source[a.i-1]||"\\"!==a.source[a.i-1]))k&&k===j?k=!1:k||(k=j);f+=j}else a.protoStart||(h||(a.save("__SNAKESKIN_RESULT__ += '"),h=!0),a.parentName||a.save(j))}a.res=this._uescape(a.res,a.quotContent).replace(/__SNAKESKIN_ESCAPE__OR/g,"||").replace(/__SNAKESKIN_CDATA__(\d+)/g,
function(b,a){return z[a].replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\v/gm,"\\v").replace(/'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");a.res+=!b?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";a.res+=c?"}":"";if(b)return a.res;console.log(a.res);return a.res};Snakeskin.Directions.template=function(a,c,b,e){var d,g,h,f="";b.startI=b.i+1;c=/(.*?)\(/.exec(a)[1];b.tplName=d=this._uescape(c,b.quotContent);if(0!==b.beginI)throw this.error("Missing closing or opening tag in the template (command: {"+
a+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');b.beginI++;b.canWrite=!1!==this.write[d];e.dryRun||(/\s+extends\s+/.test(a)&&(b.parentName=g=this._uescape(/\s+extends\s+(.*)/.exec(a)[1],b.quotContent)),n[d]={},l[d]={},v[d]=0,p[d]={},w[d]=0,t[d]={},x[d]=g,h=/\((.*?)\)/.exec(a)[1],b.save("/* Snakeskin template: "+d+"; "+h.replace(/=(.*?)(?:,|$)/g,"")+" */"),/\.|\[/.test(c)||e.commonJS?(c.replace(/\[/g,".").replace(/]/g,"").split(".").reduce(function(a,c,d){nmCache[a]||(b.save("if (typeof "+
(opt_commonjs?"exports.":"")+a+" === 'undefined') { "+(opt_commonjs?"exports.":1===d?u?"var ":"window.":"")+a+" = {}; }"),nmCache[a]=!0);return"__SNAKESKIN_QUOT__"===c.substring(0,18)?a+"["+c+"]":a+"."+c}),b.save((opt_commonjs?"exports.":"")+c+"= function (")):b.save((!u?"window."+c+" = ":"")+"function "+(u?c:"")+"("),h=h.split(","),q[d]=q[g]?q[g].concat(h):h,q[g]&&q[g].forEach(function(b){var a=b.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();h.forEach(function(c,d){var f=c.split("=");f[0]=f[0].trim();
f[1]=f[1]&&f[1].trim();a[0]===f[0]&&"undefined"===typeof f[1]&&(h[d]=b)})}),h.forEach(function(a,c){var e=a.split("=");e[0]=e[0].trim();b.save(e[0]);1<e.length&&(q[g]&&!f&&q[g].forEach(function(b){var a=b.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();!h.some(function(b){b=b.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();return b[0]===a[0]})&&"undefined"!==typeof a[1]&&(f+="var "+a[0]+" = "+a[1]+";",t[d][a[0]]=b)}),e[1]=e[1].trim(),f+=e[0]+" = typeof "+e[0]+" !== 'undefined' && "+e[0]+" !== null ? "+
e[0]+" : "+e[1]+";");t[d][e[0]]=a;c!==h.length-1&&b.save(",")}),b.save(") { "+f+"var __SNAKESKIN_RESULT__ = '';"))};Snakeskin.Directions.templateEnd=function(a,c,b,e){var d=b.tplName,g=b.parentName,h=b.source,f=b.i,j=b.startI;if(b.backHashI)throw this.error('Proto "'+b.lastBack+'" is not defined (command: {'+a+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');if(!e.dryRun){s[d]=h.substring(j,f-c-1);if(g)return b.source=h.substring(0,j)+this._getExtStr(d,e.info)+h.substring(f-c-1),n[d]=
{},l[d]={},v[d]=0,p[d]={},w[d]=0,t[d]={},b.i=j-1,b.beginI++,!1===this.write[g]&&(b.res=b.res.replace(RegExp("/\\* Snakeskin template: "+g.replace(/([.\[\]^$])/g,"\\$1")+";[\\s\\S]*?/\\* Snakeskin template\\. \\*/","m"),"")),b.parentName=!1;b.save("return __SNAKESKIN_RESULT__; };if (typeof Snakeskin !== 'undefined') {Snakeskin.cache['"+this._uescape(d,b.quotContent).replace(/'/g,"\\'")+"'] = "+(e.commonJS?"exports.":"")+d+";}/* Snakeskin template. */");b.canWrite=!0;b.tplName=null}};Snakeskin.Directions.block=
function(a,c,b,e){c=b.tplName;var d=b.parentName;if(!e.dryRun&&(d&&!b.hasPos("block",!0)&&!b.hasPos("proto",!0)||!d)){if(n[c][a])throw this.error('Block "'+a+'" is already defined (command: {block '+a+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+'")!');n[c][a]={from:b.i-b.startI+1}}b.setPos("block",{name:a,i:++b.beginI},!0)};Snakeskin.Directions.blockEnd=function(a,c,b,e){a=b.parentName;var d=b.getLastPos("block",!0);b.sysPosCache.block.pop();if(!e.dryRun&&(a&&!b.hasPos("block",!0)&&!b.hasPos("proto",
!0)||!a))n[b.tplName][d.name].to=b.i-b.startI-c-1};Snakeskin.Directions.proto=function(a,c,b,e){c=b.tplName;var d=b.parentName;if(!e.dryRun&&(d&&!b.hasPos("block",!0)&&!b.hasPos("proto",!0)||!d)){if(l[c][a])throw this.error('Proto "'+a+'" is already defined (command: {proto'+a+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+'")!');l[c][a]={from:b.i-b.startI+1}}b.setPos("proto",{name:a,i:++b.beginI,startI:b.i+1},!0);d||(b.protoStart=!0)};Snakeskin.Directions.protoEnd=function(a,c,b,e){var d=
b.tplName;a=b.parentName;var g=b.i,h=b.backHash,f=b.getLastPos("proto",!0);b.sysPosCache.proto.pop();if(!e.dryRun&&(a&&!b.hasPos("block",!0)&&!b.hasPos("proto",!0)||!a))l[d][f.name].to=g-b.startI-c-1,v[d]=g-b.startI+1;a||(l[d][f.name].body=this.compile("{template "+d+"()}"+b.source.substring(f.startI,g-c-1)+"{end}",null,!0));h[f.name]&&!h[f.name].protoStart&&(this.forEach(h[f.name],function(a){b.replace(b.res.substring(0,a)+l[d][f.name].body+b.res.substring(a))}),delete h[f.name],b.backHashI--);b.hasPos("proto")||
(b.protoStart=!1)};Snakeskin.Directions.apply=function(a,c,b){!b.parentName&&!b.hasPos("proto")&&(l[b.tplName][a]?b.save(l[b.tplName][a].body):(b.backHash[a]||(b.backHash[a]=[],b.backHash[a].protoStart=b.protoStart,b.lastBack=a,b.backHashI++),b.backHash[a].push(b.res.length)))};Snakeskin.Directions.forEach=function(a,c,b){b.setPos("forEach",++b.beginI);!b.parentName&&!b.protoStart&&(c=a.split("=>"),b.save(a[0]+" && Snakeskin.forEach("+c[0]+", function ("+(c[1]||"")+") {"))};Snakeskin.Directions.forEachEnd=
function(a,c,b){b.posCache.forEach.pop();!b.parentName&&!b.protoStart&&b.save("});")};Snakeskin.Directions["if"]=function(a,c,b){b.beginI++;!b.parentName&&!b.protoStart&&b.save("if ("+a+") {")};Snakeskin.Directions.elseIf=function(a,c,b){!b.parentName&&!b.protoStart&&b.save("} else if ("+a+") {")};Snakeskin.Directions["else"]=function(a,c,b){!b.parentName&&!b.protoStart&&b.save("} else {")};Snakeskin.Directions["with"]=function(a,c,b){b.setPos("with",{scope:a,i:++b.beginI},!0)};Snakeskin.Directions.withEnd=
function(a,c,b){b.sysPosCache.withEnd.pop()};Snakeskin.Directions["const"]=function(a,c,b,e){var d,g="",h=!1,f=b.tplName,j=b.parentName,m=b.protoStart,k=b.i,l=b.startI;if(!j&&!m&&/console\./.test(a))b.save(a+";");else if(/=(?!=)/.test(a))if(d=a.split("=")[0].trim(),f){if(p[f][d]||t[f][d])throw this.error('Variable "'+d+'" is already defined (command: {'+a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+'")!');if(P[d])throw this.error("Can't declare variable \""+d+'", try another name (command: {'+
a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+'")!');if(b.hasPos("forEach"))throw this.error('Variable "'+d+"\" can't be defined in a loop (command: {"+a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+'")!');p[f][d]={from:k-l-c,to:k-l};w[f]=k-l+1;!j&&!m&&b.save("var "+a+";")}else C[d]=!0,b.save("if (typeof Snakeskin !== 'undefined') { Snakeskin.Vars."+a+"; }");else!j&&!m&&(console.log(a),this.forEach(a.replace(/\|\|/g,"__SNAKESKIN_ESCAPE__OR").split("|"),function(a,c){var d,e;0===
c?(b.hasPos("with")?(b.setPos("with",{scope:a}),g=b.posCache["with"].reduce(function(b,a){return("undefined"===typeof b.scope?b:b.scope)+"."+a.scope}),b.posCache["with"].pop()):g=a,g="Snakeskin.Filters.undef("+(!p[f][g]&&C[g]?"Snakeskin.Vars.":"")+g+")"):(d=a.split(" "),e=d.slice(1),"!html"!==d[0]?g="Snakeskin.Filters['"+d[0]+"']("+g+(e.length?", "+e.join(""):"")+")":h=!0)}),b.save("__SNAKESKIN_RESULT__ += "+(!h?"Snakeskin.Filters.html(":"")+g+(!h?")":"")+";"))};Snakeskin.Directions.cut=function(a,
c,b){a=this._uescape(a,b.quotContent);this.write[a]||(this.write[a]=!1)};Snakeskin.Directions.save=function(a,c,b){this.write[this._uescape(a,b.quotContent)]=!0};Snakeskin.Directions.end=function(a,c,b,e){b.beginI--;var d=this,g=arguments,h=b.beginI+1,f;0===b.beginI?this.Directions.templateEnd.apply(this,arguments):b.notSysPos(h)&&(this.forEach(b.posCache,function(a,c){if((a=b.getLastPos(c))&&("undefined"!==typeof a.i&&a.i===h||a===h))return f=!0,d.Directions[c+"End"].apply(d,g),!1}),!f&&(!b.parentName&&
!b.protoStart)&&b.save("};"));this.forEach(b.sysPosCache,function(a,c){if((a=b.getLastPos(c,!0))&&("undefined"!==typeof a.i&&a.i===h||a===h))return d.Directions[c+"End"].apply(d,g),!1})};var y;if(u)for(y in Snakeskin)Snakeskin.hasOwnProperty(y)&&(exports[y]=Snakeskin[y])})("undefined"===typeof window);
