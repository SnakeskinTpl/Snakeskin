var Snakeskin={VERSION:"1.1",Filters:{},cache:{}},SS=Snakeskin;
(function(G){var z;Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});Snakeskin.forEach=function(b,c){var d=-1,a,h;if(Array.isArray(b))for(a=b.length;++d<a;)c(b[d],d,0===d,d===a-1,a);else{d=0;for(h in b)b.hasOwnProperty(h)&&d++;a=d;d=-1;for(h in b)b.hasOwnProperty(h)&&(d++,c(b[h],h,d,0===d,d===a-1,a))}};var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},Q=/[&<>"'\/]/g,R=function(b){return P[b]};Snakeskin.Filters.html=
function(b){return String(b).replace(Q,R)};Array.prototype.forEach||(Array.prototype.forEach=function(b,c){var d=-1,a=this.length;if(c)for(;(d+=1)<a;)b.call(c,this[d],d,this);else for(;(d+=1)<a;)b(this[d],d,this)});Array.prototype.some||(Array.prototype.some=function(b,c){var d=-1,a=this.length,h;if(c)for(;(d+=1)<a;){if(h=b.call(c,this[d],d,this))return!0}else for(;(d+=1)<a;)if(h=b(this[d],d,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(b,c){var d=0,a=this.length,
h;if(1===a)return this[0];for(h="undefined"!==typeof c?c:this[0];(d+=1)<a;)h=b(h,this[d],d,this);return h});String.prototype.trim||(String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),c=b.length;/\s/.test(b.charAt(c-=1)););return b.substring(0,c+1)});var J={},A={},u={},D={},K={},B={},C={},M=[],N={'"':!0,"'":!0},S={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_TMP_RESULT__:!0,__SNAKESKIN_CDATA__:!0},k;Snakeskin._getExtStr=function(b){if(!J[C[b]])throw k=Error('The specified pattern ("'+C[b]+
'" for "'+b+'") for inheritance is not defined!'),k.name="Snakeskin Error",k;for(var c=J[C[b]],d,a,h,e,g,j,l,p=-1,n=0,m=[],t;6>++p;)for(l in 0===p%2&&(d=c.length),0===p?(e=A[b],g=A[C[b]]):2===p?(e=D[b],g=D[C[b]],n=0):4===p&&(e=u[b],g=u[C[b]],n=0),e)e.hasOwnProperty(l)&&(h=c.length-d,t=0,j=J[b].substring(e[l].from,e[l].to),g[l]&&0===p%2?(1<p&&(n=g[l].from+h+j.length+1),4===p&&(a=g[l].from+h,m.some(function(b){if(b.val<a)t=b.adv;else return!0}),n+=t+4),c=c.substring(0,g[l].from+h+t)+j+c.substring(g[l].to+
h+t,c.length)):g[l]||(1===p?c+="{"+l+"}"+j+"{end}":3===p?(j="{"+j+"}",c=c.substring(0,n)+j+c.substring(n,c.length),m.push({val:n,adv:n+j.length}),n+=j.length):5===p&&(j="{"+l+"}"+j+"{end}",c=c.substring(0,n)+j+c.substring(n,c.length),n+=j.length)));return c};Snakeskin._escape=function(b){var c;b=b.split("");b.forEach(function(d,a){if(N[d]){if(!b[a-1]||"\\"!==b[a-1])c&&c===d?c=!1:c||(c=d)}else if(c)switch(d){case "|":b[a]="__SNAKESKIN_ESCAPE__PIPE";break;case "=":b[a]="__SNAKESKIN_ESCAPE__EQUAL";break;
case ",":b[a]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":b[a]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":b[a]="__SNAKESKIN_ESCAPE__BCLOSE"}});return b=b.join("")};Snakeskin._descape=function(b){return b.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,")")};Snakeskin.compile=function(b,c,d){b=(b.innerHTML||b).replace(/{cdata}([\s\S]*?){end\s+cdata}/,
function(a,b){M.push(b);return"__SNAKESKIN_CDATA__"+(M.length-1)}).replace(/\/\/.*/g,"").replace(/^\s*|\s*$/g,"").replace(/{end}\s*{template/g,"{end}{template").replace(/[\t]/g,"").replace(/[\n\r]/g,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var a=""+(!d?"/* This code is generated automatically, don't alter it. */":"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);return this;};":""),h,e,g,j,l,p,n=0,m=0,t,E=[],w=[],x,s,y=[],H,I=[],z,f="",L,r,O,q=
-1,v,F;++q<b.length;){h=b.charAt(q);if(!F)if("{"===h)if(p)n++;else{p=!0;continue}else if("}"===h&&(!n||!n--)){p=!1;f=this._escape(f);switch(f.split(" ")[0]){case "template":m++;v=q+1;e=f.replace(/^template\s+/,"").replace(/\(.*/,"");if(d)break;/\s+extends\s+/.test(f)&&(g=f.replace(/.*?\s+extends\s+(.*)/,"$1"));j=f.replace(/.*?\((.*?)\).*/,"$1");A[e]={};u[e]={};D[e]={};K[e]={};C[e]=g;a+="/* Snakeskin template: "+e+"; "+j.replace(/=(.*?)(?:,|$)/g,"")+" */";/\./.test(e)||c?(e.split(".").reduce(function(b,
d,e){a+="if (typeof "+(c?"exports.":"")+b+" === 'undefined') { "+(c?"exports.":1===e?G?"var ":"window.":"")+b+" = {}; }";return b+"."+d}),a+=(c?"exports.":"")+e+"= function ("):a+=(!G?"window."+e+" = ":"")+"function "+(G?e:"")+"(";j=j.split(",");B[e]=B[g]?B[g].concat(j):j;l="";B[g]&&B[g].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();j.forEach(function(d,e){var c=d.split("=");c[0]=c[0].trim();c[1]=c[1]&&c[1].trim();b[0]===c[0]&&"undefined"===typeof c[1]&&(j[e]=a)})});
j.forEach(function(b,d){var c=b.split("=");c[0]=c[0].trim();a+=c[0];1<c.length&&(B[g]&&!l&&B[g].forEach(function(b){var a=b.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();j.some(function(b){b=b.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();return b[0]===a[0]})||(l="undefined"!==typeof a[1]?l+("var "+a[0]+" = typeof "+a[0]+" !== 'undefined' && "+a[0]+" !== null ? "+a[0]+" : "+a[1]+";"):l+("var "+a[0]+";"))}),c[1]=c[1].trim(),K[e][c[0]]=b,l+=c[0]+" = typeof "+c[0]+" !== 'undefined' && "+c[0]+
" !== null ? "+c[0]+" : "+c[1]+";");d!==j.length-1&&(a+=",")});a+=") { "+l+"var __SNAKESKIN_RESULT__ = '', __SNAKESKIN_TMP_RESULT__;";break;case "if":m++;!g&&!s&&(a+="if ("+f.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":!g&&!s&&(a+="} else if ("+f.replace(/^elseIf\s+/,"")+") {");break;case "else":!g&&!s&&(a+="} else {");break;case "with":y.push({scope:f.replace(/^with\s+/,""),i:++m});break;case "proto":if(!d&&(g&&!w.length||!g)){if(u[e][f])throw k=Error('Proto "'+f.replace(/^proto\s+/,"")+'" is already defined (template: "'+
e+'")!'),k.name="Snakeskin Error",k;u[e][f]={from:q-v+1}}w.push({name:f,i:++m,startI:q+1});g||(s=!0);break;case "apply":if(!g&&!w.length){f=f.replace(/^apply/,"proto");if(!u[e][f])throw k=Error('Proto "'+f.replace(/^proto\s+/,"")+'" is not defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;a+=u[e][f.replace(/^apply/,"proto")].body}break;case "block":if(!d&&(g&&!E.length&&!w.length||!g)){if(A[e][f])throw k=Error('Block "'+f.replace(/^block\s+/,"")+'" is already defined (template: "'+e+'")!'),
k.name="Snakeskin Error",k;A[e][f]={from:q-v+1}}E.push({name:f,i:++m});break;case "forEach":I.push(++m);!g&&!s&&(f=f.replace(/^forEach\s+/,"").split("=>"),a+=f[0]+" && Snakeskin.forEach("+f[0]+", function ("+(f[1]||"")+") {");break;case "end":m--;h=E[E.length-1];x=w[w.length-1];H=y[y.length-1];z=I[I.length-1];if(0===m){if(d)break;J[e]=b.substring(v,q-f.length-1);if(g){b=b.substring(0,v)+this._getExtStr(e)+b.substring(q-f.length-1,b.length);A[e]={};u[e]={};D[e]={};K[e]={};q=v-1;m++;t=p=g=!1;f="";continue}a+=
"return __SNAKESKIN_RESULT__; }; Snakeskin.cache['"+e+"'] = "+(c?"exports.":"")+e+";"}else if(!g&&(!x||x.i!==m+1)&&(!h||h.i!==m+1)&&(!H||H.i!==m+1))z===m+1?(I.pop(),s||(a+="});")):s||(a+="};");if(h&&h.i===m+1&&(E.pop(),!d&&(g&&!E.length||!g)))A[e][h.name].to=q-v-f.length-1;if(x&&x.i===m+1){w.pop();if(!d&&(g&&!w.length||!g))u[e][x.name].to=q-v-f.length-1;g||(u[e][x.name].body=this.compile("{template "+e+"()}"+b.substring(x.startI,q-f.length-1)+"{end}",null,!0));w.length||(s=!1)}H&&H.i===m+1&&y.pop();
break;default:if(!g&&!s&&/console\./.test(f)){a+=f+";";break}if(/=(?!=)/.test(f)){r=f.split("=")[0].trim();if(D[e][r]||K[e][r])throw k=Error('Variable "'+r+'" is already defined (template: "'+e+'")!'),k.name="Snakeskin Error",k;if(S[r])throw k=Error("Can't declare variable \""+r+'", try another name (template: "'+e+'")!'),k.name="Snakeskin Error",k;if(I.length)throw k=Error('Variable "'+r+'" can\'t be defined in a loop (template: "'+e+'")!'),k.name="Snakeskin Error",k;D[e][r]={from:q-v-f.length,to:q-
v};!g&&!s&&(a+="var "+f+";")}else!g&&!s&&(r="",O=1,L=!1,f.split("|").forEach(function(a,b){var c,d;0===b?y.length?(y.push({scope:a}),r=y.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),y.pop()):r=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(O++,r="Snakeskin.Filters['"+c[0]+"']("+r+(d.length?", "+d.join(""):"")+")"):L=!0)}),a+="__SNAKESKIN_TMP_RESULT__ = "+(!L?"Snakeskin.Filters.html(":"")+r+(!L?")":"")+";",a+="__SNAKESKIN_RESULT__ += typeof __SNAKESKIN_TMP_RESULT__ === 'undefined' ? '' : __SNAKESKIN_TMP_RESULT__;")}f=
"";continue}if(p){!s&&t&&(a+="';",t=!1);if((N[h]||"/"===h)&&(!b[q-1]||"\\"!==b[q-1]))F&&F===h?F=!1:F||(F=h);f+=h}else s||(t||(a+="__SNAKESKIN_RESULT__ += '",t=!0),g||(a+=h))}a=this._descape(a).replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return M[b].replace(/[\n\r]/g,"").replace(/\'/g,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");a+=!d?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";if(0!==m)throw k=Error("Missing closing or opening tag in the template!"),
k.name="Snakeskin Error",k;if(d)return a;console.log(a);G?c?eval(a):global.eval(a):window.eval(a);return a};if(G)for(z in Snakeskin)Snakeskin.hasOwnProperty(z)&&(exports[z]=Snakeskin[z])})("undefined"===typeof window);
