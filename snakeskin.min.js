var Snakeskin={VERSION:"1.1",Filters:{},cache:{}},SS=Snakeskin;
(function(E){var x;Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});Snakeskin.forEach=function(b,h){var c=-1,a,e;if(Array.isArray(b))for(a=b.length;++c<a;)h(b[c],c,0===c,c===a-1,a);else{c=0;for(e in b)b.hasOwnProperty(e)&&c++;a=c;c=-1;for(e in b)b.hasOwnProperty(e)&&(c++,h(b[e],e,c,0===c,c===a-1,a))}};var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},T=/[&<>"'\/]/g,U=function(b){return S[b]};Snakeskin.Filters.html=
function(b){return String(b).replace(T,U)};Array.prototype.forEach||(Array.prototype.forEach=function(b,h){var c=-1,a=this.length;if(h)for(;(c+=1)<a;)b.call(h,this[c],c,this);else for(;(c+=1)<a;)b(this[c],c,this)});Array.prototype.some||(Array.prototype.some=function(b,h){var c=-1,a=this.length,e;if(h)for(;(c+=1)<a;){if(e=b.call(h,this[c],c,this))return!0}else for(;(c+=1)<a;)if(e=b(this[c],c,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(b,h){var c=0,a=this.length,
e;if(1===a)return this[0];for(e="undefined"!==typeof h?h:this[0];(c+=1)<a;)e=b(e,this[c],c,this);return e});String.prototype.trim||(String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),h=b.length;/\s/.test(b.charAt(h-=1)););return b.substring(0,h+1)});var F={},B={},v={},J={},C={},K={},G={},u={},L={},N=[],O={'"':!0,"'":!0},V={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_TMP_RESULT__:!0,__SNAKESKIN_CDATA__:!0},j;Snakeskin._getExtStr=function(b){if(!F[L[b]])throw j=Error('The specified pattern ("'+
L[b]+'" for "'+b+'") for inheritance is not defined!'),j.name="Snakeskin Error",j;for(var h=L[b],c=F[h],a,e,d,f,k=-1,p,m=0,u=[],l,y,q;6>++k;)for(f in 0===k?(a=B[b],e=B[h]):2===k?(a=C[b],e=C[h],m=K[h],p=null):4===k&&(a=v[b],e=v[h],m=J[h],p=null),a)if(a.hasOwnProperty(f))if(q=0,d=F[b].substring(a[f].from,a[f].to),e[f]&&(l=d.length-F[h].substring(e[f].from,e[f].to).length),y=e[f]?e[f].from:m,u.sort(function(a,b){if(a.val>b.val)return 1;if(a.val===b.val)return 0;if(a.val<b.val)return-1}).some(function(a){if(a.val<
y)q+=a.adv;else return!0}),e[f]&&0===k%2)1<k&&(p=e[f].from+q+d.length,m+=l,p>m&&(m=p+(4===k?5:1))),c=c.substring(0,e[f].from+q)+d+c.substring(e[f].to+q,c.length),u.push({val:e[f].from,adv:l});else if(!e[f])if(1===k)c+="{"+f+"}"+d+"{end}";else if(3===k||5===k)null===p&&(p=m,m+=q),d=3===k?"{"+d+"}":"{"+f+"}"+d+"{end}",c=c.substring(0,m)+d+c.substring(m,c.length),u.push({val:p,adv:d.length}),m+=d.length;return c};Snakeskin._escape=function(b){var h;b=b.split("");b.forEach(function(c,a){if(O[c]){if(!b[a-
1]||"\\"!==b[a-1])h&&h===c?h=!1:h||(h=c)}else if(h)switch(c){case "|":b[a]="__SNAKESKIN_ESCAPE__PIPE";break;case "=":b[a]="__SNAKESKIN_ESCAPE__EQUAL";break;case ",":b[a]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":b[a]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":b[a]="__SNAKESKIN_ESCAPE__BCLOSE"}});return b=b.join("")};Snakeskin._descape=function(b){return b.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,
"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,")")};Snakeskin.compile=function(b,h,c){b=(b.innerHTML||b).replace(/{cdata}([\s\S]*?){end\s+cdata}/gm,function(a,b){N.push(b);return"__SNAKESKIN_CDATA__"+(N.length-1)}).replace(/\/\/.*/gm,"").replace(/[\t\v\n\r]*/gm,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var a=""+(!c?"/* This code is generated automatically, don't alter it. */":"")+(h?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);return this;};":""),e,d=
null,f,k,p,m,x=0,l=0,y,q=[],w=[],z,s,A=[],H,I=[],P,Q={},g="",M,r,R,n=-1,t,D;++n<b.length;){e=b.charAt(n);if(!D)if("{"===e)if(m)x++;else{m=!0;continue}else if("}"===e&&(!x||!x--)){m=!1;g=this._escape(g);switch(g.split(" ")[0]){case "template":if(0!==l)throw j=Error('Missing closing or opening tag in the template (template: "'+d+'")!'),j.name="Snakeskin Error",j;l++;t=n+1;d=g.replace(/^template\s+/,"").replace(/\(.*/,"");if(c)break;/\s+extends\s+/.test(g)&&(f=g.replace(/.*?\s+extends\s+(.*)/,"$1"));
k=g.replace(/.*?\((.*?)\).*/,"$1");B[d]={};v[d]={};J[d]=0;C[d]={};K[d]=0;G[d]={};L[d]=f;a+="/* Snakeskin template: "+d+"; "+k.replace(/=(.*?)(?:,|$)/g,"")+" */";/\./.test(d)||h?(d.split(".").reduce(function(b,c,d){Q[b]||(a+="if (typeof "+(h?"exports.":"")+b+" === 'undefined') { "+(h?"exports.":1===d?E?"var ":"window.":"")+b+" = {}; }",Q[b]=!0);return b+"."+c}),a+=(h?"exports.":"")+d+"= function ("):a+=(!E?"window."+d+" = ":"")+"function "+(E?d:"")+"(";k=k.split(",");u[d]=u[f]?u[f].concat(k):k;p="";
u[f]&&u[f].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();k.forEach(function(c,d){var f=c.split("=");f[0]=f[0].trim();f[1]=f[1]&&f[1].trim();b[0]===f[0]&&"undefined"===typeof f[1]&&(k[d]=a)})});k.forEach(function(b,c){var e=b.split("=");e[0]=e[0].trim();a+=e[0];1<e.length&&(u[f]&&!p&&u[f].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();!k.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})&&"undefined"!==
typeof b[1]&&(p+="var "+b[0]+" = typeof "+b[0]+" !== 'undefined' && "+b[0]+" !== null ? "+b[0]+" : "+b[1]+";",G[d][b[0]]=a)}),e[1]=e[1].trim(),p+=e[0]+" = typeof "+e[0]+" !== 'undefined' && "+e[0]+" !== null ? "+e[0]+" : "+e[1]+";");G[d][e[0]]=b;c!==k.length-1&&(a+=",")});a+=") { "+p+"var __SNAKESKIN_RESULT__ = '', __SNAKESKIN_TMP_RESULT__;";break;case "if":l++;!f&&!s&&(a+="if ("+g.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":!f&&!s&&(a+="} else if ("+g.replace(/^elseIf\s+/,"")+") {");break;
case "else":!f&&!s&&(a+="} else {");break;case "with":A.push({scope:g.replace(/^with\s+/,""),i:++l});break;case "proto":if(!c&&(f&&!w.length||!f)){if(v[d][g])throw j=Error('Proto "'+g.replace(/^proto\s+/,"")+'" is already defined (template: "'+d+'")!'),j.name="Snakeskin Error",j;v[d][g]={from:n-t+1}}w.push({name:g,i:++l,startI:n+1});f||(s=!0);break;case "apply":if(!f&&!w.length){g=g.replace(/^apply/,"proto");if(!v[d][g])throw j=Error('Proto "'+g.replace(/^proto\s+/,"")+'" is not defined (template: "'+
d+'")!'),j.name="Snakeskin Error",j;a+=v[d][g.replace(/^apply/,"proto")].body}break;case "block":if(!c&&(f&&!q.length&&!w.length||!f)){if(B[d][g])throw j=Error('Block "'+g.replace(/^block\s+/,"")+'" is already defined (template: "'+d+'")!'),j.name="Snakeskin Error",j;B[d][g]={from:n-t+1}}q.push({name:g,i:++l});break;case "forEach":I.push(++l);!f&&!s&&(g=g.replace(/^forEach\s+/,"").split("=>"),a+=g[0]+" && Snakeskin.forEach("+g[0]+", function ("+(g[1]||"")+") {");break;case "end":l--;e=q[q.length-
1];z=w[w.length-1];H=A[A.length-1];P=I[I.length-1];if(0===l){if(c)break;F[d]=b.substring(t,n-g.length-1);if(f){b=b.substring(0,t)+this._getExtStr(d)+b.substring(n-g.length-1,b.length);B[d]={};v[d]={};J[d]=0;C[d]={};K[d]=0;G[d]={};n=t-1;l++;y=m=f=!1;g="";continue}a+="return __SNAKESKIN_RESULT__; }; Snakeskin.cache['"+d+"'] = "+(h?"exports.":"")+d+";";d=null}else if(!f&&(!z||z.i!==l+1)&&(!e||e.i!==l+1)&&(!H||H.i!==l+1))P===l+1?(I.pop(),s||(a+="});")):s||(a+="};");if(e&&e.i===l+1&&(q.pop(),!c&&(f&&!q.length&&
!w.length||!f)))B[d][e.name].to=n-t-g.length-1;if(z&&z.i===l+1){w.pop();if(!c&&(f&&!w.length||!f))v[d][z.name].to=n-t-g.length-1,J[d]=n-t+1;f||(v[d][z.name].body=this.compile("{template "+d+"()}"+b.substring(z.startI,n-g.length-1)+"{end}",null,!0));w.length||(s=!1)}H&&H.i===l+1&&A.pop();break;default:if(!f&&!s&&/console\./.test(g)){a+=g+";";break}if(/=(?!=)/.test(g)){r=g.split("=")[0].trim();if(C[d][r]||G[d][r])throw j=Error('Variable "'+r+'" is already defined (template: "'+d+'")!'),j.name="Snakeskin Error",
j;if(V[r])throw j=Error("Can't declare variable \""+r+'", try another name (template: "'+d+'")!'),j.name="Snakeskin Error",j;if(I.length)throw j=Error('Variable "'+r+'" can\'t be defined in a loop (template: "'+d+'")!'),j.name="Snakeskin Error",j;C[d][r]={from:n-t-g.length,to:n-t};K[d]=n-t+1;!f&&!s&&(a+="var "+g+";")}else!f&&!s&&(r="",R=1,M=!1,g.split("|").forEach(function(a,b){var c,d;0===b?A.length?(A.push({scope:a}),r=A.reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),
A.pop()):r=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(R++,r="Snakeskin.Filters['"+c[0]+"']("+r+(d.length?", "+d.join(""):"")+")"):M=!0)}),a+="__SNAKESKIN_TMP_RESULT__ = "+(!M?"Snakeskin.Filters.html(":"")+r+(!M?")":"")+";",a+="__SNAKESKIN_RESULT__ += typeof __SNAKESKIN_TMP_RESULT__ === 'undefined' ? '' : __SNAKESKIN_TMP_RESULT__;")}g="";continue}if(m){!s&&y&&(a+="';",y=!1);if((O[e]||"/"===e)&&(!b[n-1]||"\\"!==b[n-1]))D&&D===e?D=!1:D||(D=e);g+=e}else s||(y||(a+="__SNAKESKIN_RESULT__ += '",y=!0),
f||(a+=e))}a=this._descape(a).replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return N[b].replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\v/gm,"\\v").replace(/\'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");a+=!c?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";if(0!==l)throw j=Error("Missing closing or opening tag in the template!"),j.name="Snakeskin Error",j;if(c)return a;E?h?eval(a):global.eval(a):window.eval(a);return a};if(E)for(x in Snakeskin)Snakeskin.hasOwnProperty(x)&&
(exports[x]=Snakeskin[x])})("undefined"===typeof window);
