var Snakeskin={VERSION:"1.1",Filters:{},cache:{}},SS=Snakeskin;
(function(E){var x;Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});Snakeskin.forEach=function(b,h){var c=-1,a,g;if(Array.isArray(b))for(a=b.length;++c<a;)h(b[c],c,0===c,c===a-1,a);else{c=0;for(g in b)b.hasOwnProperty(g)&&c++;a=c;c=-1;for(g in b)b.hasOwnProperty(g)&&(c++,h(b[g],g,c,0===c,c===a-1,a))}};var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},T=/[&<>"'\/]/g,U=function(b){return S[b]};Snakeskin.Filters.html=
function(b){return String(b).replace(T,U)};Array.prototype.forEach||(Array.prototype.forEach=function(b,h){var c=-1,a=this.length;if(h)for(;(c+=1)<a;)b.call(h,this[c],c,this);else for(;(c+=1)<a;)b(this[c],c,this)});Array.prototype.some||(Array.prototype.some=function(b,h){var c=-1,a=this.length,g;if(h)for(;(c+=1)<a;){if(g=b.call(h,this[c],c,this))return!0}else for(;(c+=1)<a;)if(g=b(this[c],c,this))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(b,h){var c=0,a=this.length,
g;if(1===a)return this[0];for(g="undefined"!==typeof h?h:this[0];(c+=1)<a;)g=b(g,this[c],c,this);return g});String.prototype.trim||(String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),h=b.length;/\s/.test(b.charAt(h-=1)););return b.substring(0,h+1)});var F={},B={},v={},J={},C={},K={},G={},u={},L={},N=[],O={'"':!0,"'":!0},V={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_TMP_RESULT__:!0,__SNAKESKIN_CDATA__:!0},j;Snakeskin._getExtStr=function(b){if(!F[L[b]])throw j=Error('The specified pattern ("'+
L[b]+'" for "'+b+'") for inheritance is not defined!'),j.name="Snakeskin Error",j;for(var h=L[b],c=F[h],a,g,d,f,k=-1,s,n=0,u=[],l,y,q;6>++k;)for(f in 0===k?(a=B[b],g=B[h]):2===k?(a=C[b],g=C[h],n=K[h]):4===k&&(a=v[b],g=v[h],n=J[h]),a)if(a.hasOwnProperty(f))if(q=0,d=F[b].substring(a[f].from,a[f].to),g[f]&&(l=d.length-F[h].substring(g[f].from,g[f].to).length),g[f]&&0===k%2)y=g[f].from,u.sort(function(a,b){if(a.val>b.val)return 1;if(a.val===b.val)return 0;if(a.val<b.val)return-1}).some(function(a){if(a.val<
y)q+=a.adv;else return!0}),1<k&&(s=g[f].from+q+d.length+1,n+=l,s>n&&(n=s)),c=c.substring(0,g[f].from+q)+d+c.substring(g[f].to+q,c.length),u.push({val:g[f].from,adv:l});else if(!g[f])if(1===k)c+="{"+f+"}"+d+"{end}";else if(3===k||5===k)d=3===k?"{"+d+"}":"{"+f+"}"+d+"{end}",c=c.substring(0,n)+d+c.substring(n,c.length),u.push({val:s,adv:d.length}),n+=d.length;console.log(c);return c};Snakeskin._escape=function(b){var h;b=b.split("");b.forEach(function(c,a){if(O[c]){if(!b[a-1]||"\\"!==b[a-1])h&&h===c?
h=!1:h||(h=c)}else if(h)switch(c){case "|":b[a]="__SNAKESKIN_ESCAPE__PIPE";break;case "=":b[a]="__SNAKESKIN_ESCAPE__EQUAL";break;case ",":b[a]="__SNAKESKIN_ESCAPE__COMMA";break;case "(":b[a]="__SNAKESKIN_ESCAPE__BOPEN";break;case ")":b[a]="__SNAKESKIN_ESCAPE__BCLOSE"}});return b=b.join("")};Snakeskin._descape=function(b){return b.replace(/__SNAKESKIN_ESCAPE__PIPE/g,"|").replace(/__SNAKESKIN_ESCAPE__EQUAL/g,"=").replace(/__SNAKESKIN_ESCAPE__COMMA/g,",").replace(/__SNAKESKIN_ESCAPE__BOPEN/g,"(").replace(/__SNAKESKIN_ESCAPE__BCLOSE/g,
")")};Snakeskin.compile=function(b,h,c){b=(b.innerHTML||b).replace(/{cdata}([\s\S]*?){end\s+cdata}/,function(a,b){N.push(b);return"__SNAKESKIN_CDATA__"+(N.length-1)}).replace(/\/\/.*/g,"").replace(/^\s*|\s*$/g,"").replace(/{end}\s*{template/g,"{end}{template").replace(/[\t]/g,"").replace(/\n/g,"").replace(/\r/g,"").replace(/\/\*[\s\S]*?\*\//g,"");for(var a=""+(!c?"/* This code is generated automatically, don't alter it. */":"")+(h?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);return this;};":
""),g,d,f,k,s,n,x=0,l=0,y,q=[],w=[],z,r,A=[],H,I=[],P,Q={},e="",M,p,R,m=-1,t,D;++m<b.length;){g=b.charAt(m);if(!D)if("{"===g)if(n)x++;else{n=!0;continue}else if("}"===g&&(!x||!x--)){n=!1;e=this._escape(e);switch(e.split(" ")[0]){case "template":if(0!==l)throw j=Error('Missing closing or opening tag in the template (template: "'+d+'")!'),j.name="Snakeskin Error",j;l++;t=m+1;d=e.replace(/^template\s+/,"").replace(/\(.*/,"");if(c)break;/\s+extends\s+/.test(e)&&(f=e.replace(/.*?\s+extends\s+(.*)/,"$1"));
k=e.replace(/.*?\((.*?)\).*/,"$1");B[d]={};v[d]={};J[d]=0;C[d]={};K[d]=0;G[d]={};L[d]=f;a+="/* Snakeskin template: "+d+"; "+k.replace(/=(.*?)(?:,|$)/g,"")+" */";/\./.test(d)||h?(d.split(".").reduce(function(b,c,d){Q[b]||(a+="if (typeof "+(h?"exports.":"")+b+" === 'undefined') { "+(h?"exports.":1===d?E?"var ":"window.":"")+b+" = {}; }",Q[b]=!0);return b+"."+c}),a+=(h?"exports.":"")+d+"= function ("):a+=(!E?"window."+d+" = ":"")+"function "+(E?d:"")+"(";k=k.split(",");u[d]=u[f]?u[f].concat(k):k;s="";
u[f]&&u[f].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();k.forEach(function(c,d){var f=c.split("=");f[0]=f[0].trim();f[1]=f[1]&&f[1].trim();b[0]===f[0]&&"undefined"===typeof f[1]&&(k[d]=a)})});k.forEach(function(b,c){var e=b.split("=");e[0]=e[0].trim();a+=e[0];1<e.length&&(u[f]&&!s&&u[f].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();!k.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})&&"undefined"!==
typeof b[1]&&(s+="var "+b[0]+" = typeof "+b[0]+" !== 'undefined' && "+b[0]+" !== null ? "+b[0]+" : "+b[1]+";",G[d][b[0]]=a)}),e[1]=e[1].trim(),s+=e[0]+" = typeof "+e[0]+" !== 'undefined' && "+e[0]+" !== null ? "+e[0]+" : "+e[1]+";");G[d][e[0]]=b;c!==k.length-1&&(a+=",")});a+=") { "+s+"var __SNAKESKIN_RESULT__ = '', __SNAKESKIN_TMP_RESULT__;";break;case "if":l++;!f&&!r&&(a+="if ("+e.replace(/^\/?if\s+/,"")+") {");break;case "elseIf":!f&&!r&&(a+="} else if ("+e.replace(/^elseIf\s+/,"")+") {");break;
case "else":!f&&!r&&(a+="} else {");break;case "with":A.push({scope:e.replace(/^with\s+/,""),i:++l});break;case "proto":if(!c&&(f&&!w.length||!f)){if(v[d][e])throw j=Error('Proto "'+e.replace(/^proto\s+/,"")+'" is already defined (template: "'+d+'")!'),j.name="Snakeskin Error",j;v[d][e]={from:m-t+1}}w.push({name:e,i:++l,startI:m+1});f||(r=!0);break;case "apply":if(!f&&!w.length){e=e.replace(/^apply/,"proto");if(!v[d][e])throw j=Error('Proto "'+e.replace(/^proto\s+/,"")+'" is not defined (template: "'+
d+'")!'),j.name="Snakeskin Error",j;a+=v[d][e.replace(/^apply/,"proto")].body}break;case "block":if(!c&&(f&&!q.length&&!w.length||!f)){if(B[d][e])throw j=Error('Block "'+e.replace(/^block\s+/,"")+'" is already defined (template: "'+d+'")!'),j.name="Snakeskin Error",j;B[d][e]={from:m-t+1}}q.push({name:e,i:++l});break;case "forEach":I.push(++l);!f&&!r&&(e=e.replace(/^forEach\s+/,"").split("=>"),a+=e[0]+" && Snakeskin.forEach("+e[0]+", function ("+(e[1]||"")+") {");break;case "end":l--;g=q[q.length-
1];z=w[w.length-1];H=A[A.length-1];P=I[I.length-1];if(0===l){if(c)break;F[d]=b.substring(t,m-e.length-1);if(f){b=b.substring(0,t)+this._getExtStr(d)+b.substring(m-e.length-1,b.length);B[d]={};v[d]={};J[d]=0;C[d]={};K[d]=0;G[d]={};m=t-1;l++;y=n=f=!1;e="";continue}a+="return __SNAKESKIN_RESULT__; }; Snakeskin.cache['"+d+"'] = "+(h?"exports.":"")+d+";"}else if(!f&&(!z||z.i!==l+1)&&(!g||g.i!==l+1)&&(!H||H.i!==l+1))P===l+1?(I.pop(),r||(a+="});")):r||(a+="};");if(g&&g.i===l+1&&(q.pop(),!c&&(f&&!q.length&&
!w.length||!f)))B[d][g.name].to=m-t-e.length-1;if(z&&z.i===l+1){w.pop();if(!c&&(f&&!w.length||!f))v[d][z.name].to=m-t-e.length-1,J[d]=m-t-e.length;f||(v[d][z.name].body=this.compile("{template "+d+"()}"+b.substring(z.startI,m-e.length-1)+"{end}",null,!0));w.length||(r=!1)}H&&H.i===l+1&&A.pop();break;default:if(!f&&!r&&/console\./.test(e)){a+=e+";";break}if(/=(?!=)/.test(e)){p=e.split("=")[0].trim();if(C[d][p]||G[d][p])throw j=Error('Variable "'+p+'" is already defined (template: "'+d+'")!'),j.name=
"Snakeskin Error",j;if(V[p])throw j=Error("Can't declare variable \""+p+'", try another name (template: "'+d+'")!'),j.name="Snakeskin Error",j;if(I.length)throw j=Error('Variable "'+p+'" can\'t be defined in a loop (template: "'+d+'")!'),j.name="Snakeskin Error",j;C[d][p]={from:m-t-e.length,to:m-t};K[d]=m-t+1;!f&&!r&&(a+="var "+e+";")}else!f&&!r&&(p="",R=1,M=!1,e.split("|").forEach(function(a,b){var c,d;0===b?A.length?(A.push({scope:a}),p=A.reduce(function(a,b){return("undefined"===typeof a.scope?
a:a.scope)+"."+b.scope}),A.pop()):p=a:(c=a.split(" "),d=c.slice(1),"!html"!==c[0]?(R++,p="Snakeskin.Filters['"+c[0]+"']("+p+(d.length?", "+d.join(""):"")+")"):M=!0)}),a+="__SNAKESKIN_TMP_RESULT__ = "+(!M?"Snakeskin.Filters.html(":"")+p+(!M?")":"")+";",a+="__SNAKESKIN_RESULT__ += typeof __SNAKESKIN_TMP_RESULT__ === 'undefined' ? '' : __SNAKESKIN_TMP_RESULT__;")}e="";continue}if(n){!r&&y&&(a+="';",y=!1);if((O[g]||"/"===g)&&(!b[m-1]||"\\"!==b[m-1]))D&&D===g?D=!1:D||(D=g);e+=g}else r||(y||(a+="__SNAKESKIN_RESULT__ += '",
y=!0),f||(a+=g))}a=this._descape(a).replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return N[b].replace(/[\n\r]/g,"").replace(/\'/g,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");a+=!c?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";if(0!==l)throw j=Error("Missing closing or opening tag in the template!"),j.name="Snakeskin Error",j;if(c)return a;E?h?eval(a):global.eval(a):window.eval(a);return a};if(E)for(x in Snakeskin)Snakeskin.hasOwnProperty(x)&&(exports[x]=
Snakeskin[x])})("undefined"===typeof window);
