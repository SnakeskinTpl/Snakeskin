var __NEJS_THIS__=this;if(!Array.isArray){var toString=Object.prototype.toString;Array.isArray=function(a){return"[object Array]"===toString.call(a)}}String.prototype.trim||(String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=a.length,c=/\s/;c.test(a.charAt(--b)););return a.substring(0,b+1)});var __NEJS_THIS__=this,Snakeskin={VERSION:[3,0,0],Directions:{},Filters:{},Vars:{},cache:{}};!function(a){function b(a,b){var c=this;for(var d in this)this[d]&&this[d].init&&(this[d]=this[d].init());this.commonJS=b.commonJS,this.scope=b.scope||[],this.proto=b.proto,this.info=b.info,this.name=null,this.canWrite=!0,this.space=!1,this.strongSpace=!1,this.i=-1,this.blockStructure=null,this.blockTable=null,this.structure={name:"root",parent:null,vars:b.vars||{},childs:[]},this.inlineDir=null,this.strongDir=null,this.returnStrongDir=null,this.quotContent=[],this.cDataContent=[],this.source=String(a).replace(/{cdata}([\s\S]*?){(?:\/cdata|end cdata)}/gm,function(a,b){return c.cDataContent.push(b),"{__appendLine__ "+(b.match(/[\n\r]/g)||"").length+"}__SNAKESKIN_CDATA__"+(c.cDataContent.length-1)+"_"}),this.res=(b.proto?"":"/* This code is generated automatically, don't alter it. */")+(b.commonJS?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);exec();return this;};function exec() {":"")}Snakeskin.importFilters=function(a,b){var c=Snakeskin.Filters;if(b)for(var d=b.split("."),e=0;e<d.length;e++)c[d[e]]||(c[d[e]]={}),c=c[d[e]];for(var f in a)a.hasOwnProperty(f)&&(c[f]=a[f])};var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},d=/[&<>"'\/]/g,e=function(a){return c[a]};Snakeskin.Filters.html=function(a){return(a+"").replace(d,e)},Snakeskin.Filters.undef=function(a){return void 0!==a?a:""};var f={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"},g=/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,h=function(a){return f[a]};Snakeskin.Filters.uhtml=function(a){return(a+"").replace(g,h)};var i=/<\/?[^>]+>/g;Snakeskin.Filters.stripTags=function(a){return(a+"").replace(i,"")};var j=/%5B/g,k=/%5D/g;Snakeskin.Filters.uri=function(a){return encodeURI(a+"").replace(j,"[").replace(k,"]")},Snakeskin.Filters.upper=function(a){return(a+"").toUpperCase()},Snakeskin.Filters.ucfirst=function(a){return a+="",a.charAt(0).toUpperCase()+a.substring(1)},Snakeskin.Filters.lower=function(a){return(a+"").toLowerCase()},Snakeskin.Filters.lcfirst=function(a){return a+="",a.charAt(0).toLowerCase()+a.substring(1)},Snakeskin.Filters.trim=function(a){return(a+"").trim()};var l=/\s{2,}/g;Snakeskin.Filters.collapse=function(a){return(a+"").replace(l," ").trim()},Snakeskin.Filters.truncate=function(a,b,c){if(a+="",!a||a.length<=b)return a;for(var d,e=a.substring(0,b-1),f=e.length;f--&&c;)if(" "===e.charAt(f))d=f;else if(void 0!==d)break;return(void 0!==d?e.substring(0,d):e)+"â€¦"},Snakeskin.Filters.repeat=function(a,b){return new Array(b||2).join(a)},Snakeskin.Filters.remove=function(a,b){return(a+"").replace(b,"")},Snakeskin.Filters.replace=function(a,b,c){return(a+"").replace(b,c)},Snakeskin.Filters.json=function(a){return"object"==typeof a?JSON.stringify(a):a+""};var m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_CDATA__:!0,__I_PROTO__:!0,__I__:!0,__TMP__:!0,__TMP_LENGTH__:!0,__KEY__:!0,$_:!0},D={'"':!0,"'":!0,"/":!0},E={"-":!0,"+":!0,"*":!0,",":!0,";":!0,"=":!0,"|":!0,"&":!0,"?":!0,":":!0,"(":!0,"{":!0};Snakeskin.DirObj=b,b.prototype.save=function(a){return this.tplName&&B[this.tplName]===!1?!1:(this.res+=a,!0)},b.prototype.isSimpleOutput=function(){if("end"!==this.name&&this.strongDir)throw this.error('Directive "'+this.structure.name+'" can not be used with a "'+this.strongDir+'"');return!(this.parentTplName||this.protoStart||this.proto&&this.proto.parentTplName)},b.prototype.isAdvTest=function(){return!(this.proto||this.protoLink||(!this.parentTplName||this.hasParentBlock({block:!0,proto:!0}))&&this.parentTplName)},b.prototype.initTemplateCache=function(a){return q[a]={},p[a]={},r[a]=0,s[a]={},t[a]=0,u[a]={},this},b.prototype.startDir=function(a,b,c){var d=this;"undefined"==typeof c&&(c={}),a=a||this.name,b=b||{},this.inlineDir=!1;var e=c||{},f=this.structure;if(f.vars){var g=Object(f.vars);for(var h in g)g.hasOwnProperty(h)&&(e[h]=g[h])}var i={name:a,parent:f,childs:[],vars:e,params:b,sys:!!z[a]};if(f.childs.push(i),this.structure=i,this.blockStructure&&("block"===a||"proto"===a)){var j={name:a,parent:this.blockStructure,childs:[],params:b},k=a+"_"+b.name;this.blockTable[k]===!0&&(j.drop=!0),this.blockTable[k]=j;var l=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=c.name+"_"+c.params.name;d.blockTable[e]?d.blockTable[e].drop=!0:d.blockTable[e]=!0,c.childs&&l(c.childs)}};this.parentTplName&&o[this.parentTplName][k]&&o[this.parentTplName][k].childs&&l(o[this.parentTplName][k].childs),this.blockStructure.childs.push(j),this.blockStructure=j}return this},b.prototype.startInlineDir=function(a,b){"undefined"==typeof b&&(b={}),a=a||this.name,this.inlineDir=!0;var c={name:a,parent:this.structure,params:b};if(this.structure.childs.push(c),this.structure=c,this.blockStructure&&"const"===a){var d={name:a,parent:this.blockStructure,params:b};this.blockTable[a+"_"+b.name]=d,this.blockStructure.childs.push(d),this.blockStructure=d}return this},b.prototype.endDir=function(){var a=this.structure.name;return this.structure=this.structure.parent,!this.blockStructure||"block"!==a&&"proto"!==a||(this.blockStructure=this.blockStructure.parent),this},b.prototype.has=function(a,b){for(var c=b||this.structure;;){if(a[c.name]||c.name===a)return!0;if(!c.parent||"root"===c.parent.name)return!1;c=c.parent}},b.prototype.hasParent=function(a){return this.structure.parent?this.has(a,this.structure.parent):!1},b.prototype.hasParentBlock=function(a){return this.blockStructure&&this.blockStructure.parent?this.has(a,this.blockStructure.parent):!1},b.prototype.declVar=function(a){if(s[this.tplName][a]||u[this.tplName][a])throw this.error('Variable "'+a+'" is already defined as constant');for(var b=this.structure;!b.vars;)b=this.structure.parent;var c="__"+a+"_"+(this.proto?this.proto.name:"")+"_"+b.name+"_"+this.i;return b.vars[a]={value:c,useWith:!!this.scope.length},this.varCache[this.tplName][a]=!0,c},b.prototype.multiDeclVar=function(a,b){"undefined"==typeof b&&(b=!0);for(var c=0,d="",e="var ",f={"(":!0,"[":!0,"{":!0},g={")":!0,"]":!0,"}":!0},h=a.length,i=0;h>i;i++){var j=a.charAt(i);if(f[j]?c++:g[j]&&c--,","!==j&&i!==h-1||c)d+=j;else{i===h-1&&(d+=j);var k=d.split("="),l=this.declVar(k[0].trim());k[0]=l+" ",e+=this.prepareOutput(k.join("=")+",",!0,null,!0),d=""}}if(c)throw this.error("Invalid syntax");return e.slice(0,-1)+(b?";":"")};var F={VERSION:"1.0.2",isLocal:"undefined"==typeof window?!!global.EscaperIsLocal:!1};"undefined"!=typeof window||F.isLocal||(module.exports=exports=F),function(){var a={'"':!0,"'":!0,"/":!0},b={"-":!0,"+":!0,"*":!0,",":!0,";":!0,"=":!0,"|":!0,"&":!0,"?":!0,":":!0,"(":!0,"{":!0},c={};F.quotContent=[],F.replace=function(d,e,f){e=!!e;var g=d;if(f&&c[g]&&c[g][e])return c[g][e];for(var h,i,j,k,l=f||this.quotContent,m=!0,n=!1,o=0,p=!1,q=0;q<d.length;q++){var r=d.charAt(q),s=d.charAt(q-1),t=d.charAt(q+1);if(i)("\n"===t&&"//"===i||"/"===r&&"*"===s&&"/*"===i)&&(i=!1,e&&(j=d.substring(o,q+1),k="__ESCAPER_QUOT__"+l.length+"_",l.push(j),d=d.substring(0,o)+k+d.substring(q+1),q+=k.length-j.length));else{if(!h){if("/"===r){switch(t){case"*":i="/*";break;case"/":i="//"}if(i){o=q;continue}}b[r]?m=!0:/[^\s\/]/.test(r)&&(m=!1)}if("/"===h&&!n)switch(r){case"[":p=!0;break;case"]":p=!1}a[r]&&("/"===r?m:!0)&&!h?(h=r,o=q):h&&("\\"===r||n)?n=!n:!a[r]||h!==r||n||("/"===h?p:0)||(h=!1,j=d.substring(o,q+1),k="__ESCAPER_QUOT__"+l.length+"_",l.push(j),d=d.substring(0,o)+k+d.substring(q+1),q+=k.length-j.length)}}return f&&l===this.quotContent&&(c[g]=c[g]||{},c[g][e]=d),d},F.paste=function(a,b){var c=b||this.quotContent;return a.replace(/__ESCAPER_QUOT__(\d+)_/gm,function(a,b){return c[b]})}}();b.prototype.applyDefEscape=function(a){return a.replace(/\\/gm,"\\\\").replace(/'/gm,"\\'")},b.prototype.escapeNextLine=function(a){return a.replace(/\n/gm,"\\n").replace(/\v/gm,"\\v").replace(/\r/gm,"\\r")},"undefined"==typeof window&&(global.EscaperIsLocal=!0),b.prototype.replaceDangerBlocks=function(a){return F.replace(a,!0,this.quotContent)},b.prototype.pasteDangerBlocks=function(a){return F.paste(a,this.quotContent)};b.prototype.getExtStr=function(a){function b(a,b){return a.val>b.val?1:a.val===b.val?0:-1}for(var c,d=w[a],e=n[d],f=0,g=[],h=o[a],i=0;6>i;i++){var j,k,l;0===i?(c="block_",j=p[a],k=p[d]):2===i?(c="const_",j=s[a],k=s[d],f=t[d],l=null):4===i&&(c="proto_",j=q[a],k=q[d],f=r[d],l=null);var m;for(var u in j)if(j.hasOwnProperty(u)){var v=0,x=j[u],y=!h[c+u].drop&&k[u];4===i&&y&&x.argsDecl!==y.argsDecl&&(x.from-=x.length,y.from-=y.length);var z=n[a].substring(x.from,x.to);y&&(m=z.length-n[d].substring(y.from,y.to).length);var A=y?y.from:f;g.sort(b);for(var B=0;B<g.length&&g[B].val<A;B++)v+=g[B].adv;y&&i%2===0?(i>1&&(l=y.from+v+z.length,f+=m,l>f&&(f=l+(4===i?5:1))),e=e.substring(0,y.from+v)+z+e.substring(y.to+v),g.push({val:y.from,adv:m})):y||(1===i?e+="{block "+u+"}"+z+"{end}":(3===i||5===i)&&(null===l&&(l=f,f+=v),z=3===i?"{"+z+"}":"{proto "+u+x.argsDecl+"}"+z+"{end}",e=e.substring(0,f)+z+e.substring(f),g.push({val:l,adv:z.length}),f+=z.length))}}return e};b.prototype.genErrorAdvInfo=function(a){"undefined"==typeof a&&(a=this.info);var b="";if(!a)return b;for(var c in a)a.hasOwnProperty(c)&&(b+=a[c].innerHTML?c+": (class: "+(a[c].className||"undefined")+", id: "+(a[c].id||"undefined")+"), ":c+": "+a[c]+", ");return b.replace(/, $/,"")},b.prototype.error=function(a){var b=new Error(a+", "+this.genErrorAdvInfo());return b.name="Snakeskin Error",b};Snakeskin.compile=function(c,d,e,f){"undefined"==typeof f&&(f={}),e=e||{line:1};var g=c.innerHTML;g&&(e.node=c,g=g.replace(/\s*?\n/,""));var h=g||c;if(m[h])return m[h];for(var i,j,k=new b(String(h),{info:e,commonJS:!!d,proto:f.proto,scope:f.scope,vars:f.vars}),l=!1,n="",o=0,p=!1,q=!1,r=!1,s=!1,t=!1,u=/[\r\n\v]/,v=/\s/,w=/[^\s\/]/,y=/[^\s]+/m,z=/[^\s]+\s*/m;++k.i<k.source.length;){var A=k.source,B=A.charAt(k.i),C=B;if(u.test(B)&&e.line++,v.test(B)){if(l)B=i?k.escapeNextLine(B):" ";else if(k.structure.parent){if(k.space||k.strongSpace)continue;B=" ",k.space=!0}else if(!s)continue}else k.space=!1;if(!i){var F=B+A.charAt(k.i+1),G=F+A.charAt(k.i+2);if(!q)if("/"===B){if("///"===G)r=G,k.i+=2;else if("/*"===F)"/**"!==G||k.structure.parent?(r=F,k.i++):(p=!0,s=!0);else if("*"===A.charAt(k.i-1)){if("/*"===r){r=!1;continue}p&&(p=!1)}}else u.test(C)&&"///"===r&&(r=!1);if(("\\"===B||q)&&(q=!q),r||q)continue;if(!s)if("{"===B){if(!l){j=!0,l=!0;continue}o++}else if(!("}"!==B||o&&o--)){l=!1;var H=n.length;if(n=k.replaceDangerBlocks(n).trim(),!n)throw k.error("Directive is not defined");var I=n.charAt(0),J=n.substr(0,2);x[J]?n=x[J](n):x[I]&&(n=x[I](n));var K=y.exec(n)[0];K=Snakeskin.Directions[K]?K:"const";var L=Snakeskin.Directions[K](k,"const"!==K?n.replace(z,""):n,H);L===!1&&(l=!1,p=!1),n="";continue}}if(l)p&&k.isSimpleOutput()&&(k.save("';"),p=!1),i||(E[B]?j=!0:w.test(B)&&(j=!1)),D[B]&&("/"===B?j&&n:!0)&&!i?i=B:i&&("\\"===B||t)?t=!t:D[B]&&i===B&&!t&&(i=!1),n+=B;else{if(k.structure.parent)k.startInlineDir("text"),k.isSimpleOutput()&&(p||(k.save("__SNAKESKIN_RESULT__ += '"),p=!0),k.save(k.applyDefEscape(B))),k.inlineDir=null,k.structure=k.structure.parent;else{if(!s)throw k.error("Text can't be used in the global space (except jsDoc)");k.save(k.applyDefEscape(B))}p||(s=!1)}}if(k.structure.parent)throw k.error("Missing closing or opening tag in the template");return k.res=k.pasteDangerBlocks(k.res).replace(/__SNAKESKIN_CDATA__(\d+)_/g,function(a,b){return k.escapeNextLine(k.cDataContent[b]).replace(/'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,""),k.res+=k.proto?"":"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */",k.res+=d?"}":"",k.proto?k.res:(new Function(k.res)(),m[h]=k.res,a||d||setTimeout(function(){try{var a=new Blob([k.res],{type:"application/javascript"}),b=document.createElement("script");b.src=URL.createObjectURL(a),document.head.appendChild(b)}catch(c){}},50),k.res)};Snakeskin.addDirective=function(a,b,c,d){if(b=b||{},z[a]=!!b.sys,b.replacers){var e=b.replacers;for(var f in e)e.hasOwnProperty(f)&&(x[f]=e[f])}y[a]=b.strongDirs,Snakeskin.Directions[a]=function(d,e,f){switch(b.placement){case"template":if(!d.structure.parent)throw d.error('Directive "'+a+'" can only be used within a "template" or "proto"');break;case"global":if(d.structure.parent)throw d.error('Directive "'+a+'" can be used only within the global space');break;default:if(b.placement&&d.hasParent(b.placement))throw d.error('Directive "'+a+'" can be used only within a "'+b.placement+'"')}if(b.notEmpty&&!e)throw this.error("Invalid syntax");if(d.name=a,d.strongDir&&y[d.strongDir][a]&&(d.returnStrongDir={child:a,dir:d.strongDir},d.strongDir=null,d.strongSpace=!1),c.call(d,e,f),d.inlineDir===!0){var g=d.structure.name;d.inlineDir=null,d.structure=d.structure.parent,d.blockStructure&&"const"===g&&(d.blockStructure=d.blockStructure.parent)}y[a]&&(d.strongDir=a,d.strongSpace=!0)},Snakeskin.Directions[a+"End"]=d};var G={"+":!0,"++":!0,"-":!0,"--":!0,"~":!0,"~~":!0,"!":!0,"!!":!0,arguments:!0,"break":!0,"case":!0,"catch":!0,"continue":!0,"delete":!0,"do":!0,"else":!0,"false":!0,finnaly:!0,"for":!0,"function":!0,"if":!0,"in":!0,"instanceof":!0,"new":!0,"null":!0,"return":!0,"switch":!0,"this":!0,"throw":!0,"true":!0,"try":!0,"typeof":!0,"var":!0,"const":!0,let:!0,"void":!0,"while":!0,"with":!0,"class":!0,"debugger":!0,"interface":!0},H={"new":!0},I={"var":!0,"const":!0,let:!0};b.prototype.replaceTplVars=function(a){a=this.pasteDangerBlocks(a);for(var b,c,d=0,e="",f=!1,g=!0,h=!1,i=function(a){return a.replace(/\\/gm,"\\\\").replace(/('|")/gm,"\\$1")},j=/[\r\n\v]/,k=/[^\s\/]/,l="",m=0;m<a.length;m++){var n=a.charAt(m),o=n+a.charAt(m+1);if(d||"${"!==o){if(d||(l+=i(n)),d){if(("\\"===n||f)&&(f=!f),!f){var p=o+a.charAt(m+2);if("/"===n){if("///"===p)b="///",m+=2;else if("/*"===o)b="/*",m++;else if("*"===a.charAt(m-1)&&"/*"===b){b=!1;continue}}else j.test(n)&&"///"===b&&(b=!1)}if(b)continue;c||(E[n]?g=!0:k.test(n)&&(g=!1)),D[n]&&("/"===n?g:!0)&&!c?c=n:c&&("\\"===n||h)?h=!h:D[n]&&c===n&&!h&&(c=!1),c||("{"===n?d++:"}"===n&&d--),d?e+=n:(f=!1,l+="' + "+this.prepareOutput(this.replaceDangerBlocks(e))+" + '")}}else d++,e="",m++}return l},b.prototype.isSyOL=function(a,b,c){for(var d,e=/\S/,f=b;f--;){var g=a.charAt(f);if(e.test(g)){d="?"===g;break}}if(!d)for(var h=c;h<a.length;h++){var i=a.charAt(h);if(e.test(i))return":"===i}return!1},b.prototype.isNextAssign=function(a,b){for(var c=/\S/,d=b;d<a.length;d++){var e=a.charAt(d);if(c.test(e))return"="===e&&"="!==a.charAt(d+1)}return!1},b.prototype.getWord=function(a,b,c){"undefined"==typeof c&&(c=!1);for(var d="",e="",f=0,g=0,h=null,i=0,j=/[@#$+\-~!\w\[\]().]/,k=b;k<a.length;k++,i++){var l=a.charAt(k);if(!(f||j.test(l)||" "===l&&H[d]))break;if(null!==h&&(f>1||1===f&&")"!==l&&"]"!==l)&&(h+=l),"("===l||"["===l)null===h&&(g=i+1,h=""),f++;else if(")"===l||"]"===l){if(!f)break;f--,f||"]"!==l||(e?e+="["+this.prepareOutput(h,!0,!0)+"]":e=d.substring(0,g)+this.prepareOutput(h,!0,!c)+d.substring(i)+"]",h=null)}d+=l}return{word:d,finalWord:e?e:h?d.substring(0,g)+this.prepareOutput(h,!0)+d.substring(i-1):d}},b.prototype.prepareOutput=function(a,b,c,d){function e(a){if(J.test(a)){var b=K.exec(a);b[1]=b[1].replace(L,M),a=b.slice(1).join("")}else a=a.replace(L,M);return a}function f(a){if(J.test(a)){var b=K.exec(a);a=b[1]}var c=L.exec(a);return c?c[0]:null}for(var g=a,h=0,i=0,j=[],k=!1,l=!1,m=[],n=[],o=!d,p=0,q=this.scope,r=!!q.length,t=0,v=0,w=0,x=!1,y=this.structure.childs?this.structure.vars:this.structure.parent.vars,z=/([$\w]*)(.*)/,A=/^__ESCAPER_QUOT__\d+_/,B=/[@#$+\-~!\w]/i,C=/[^@#$\w\[\].]/,D=/[!$a-z_]/i,E=/[0-9]/,F=/#(?:\d+|)/,H=/#(\d+)/,J=/\[|\./,K=/([^.[]+)(.*)/,L=/[^-+!]+/,M=function(a){return y[a]?y[a].value:a},N=a.length,O=0;N>O;O++){var P,Q,R=a.charAt(O),S=a.charAt(O+1),T=a.charAt(O+2);if(!Q){if("("===R&&(k?i++:(j.unshift([O+v]),h++)),o&&!p&&B.test(R)){var U,V,W=this.getWord(a,O,b),X=W.word,Y=W.finalWord,Z=v+t,$=!G[X]&&!P&&isNaN(Number(X))&&!A.test(X)&&!this.isSyOL(a,O,O+X.length);if(E.test(R))U=Y;else if("@"===R)$&&r?(U=Y.substring("@"===S?2:1),V=z.exec(U),U="@"===S?"Snakeskin.Vars['"+V[1]+"']"+V[2]:e(U)):(V=z.exec(Y.substring("@"===S?2:1)),U="Snakeskin.Vars['"+V[1]+"']"+V[2]);else{var _=Y.replace(F,"");if($&&r){var ab=y[f(_)];if(ab&&ab.useWith)U=e(_);else{var bb=null;"#"===R&&(bb=H.exec(Y),bb=bb?bb[1]:1,bb++);var cb=q[0];q.push(_);var db=bb=bb?q.length-bb:bb,eb=q.length;if(null!==bb&&0>=bb)U=e(_);else{U=e(cb);for(var fb=1;eb>fb;fb++)bb=bb?bb-1:bb,null===bb||bb>0?U+="."+q[fb]:fb===eb-1&&(U=(db>0?U+".":"")+q[fb])}q.pop()}}else U=$?e(_):_}if($&&this.isNextAssign(a,O+X.length)&&(s[this.tplName][U]||u[this.tplName][U]))throw this.error('Constant "'+U+'" is already defined');if(I[Y]?p=2:!$||b&&!c||(U="Snakeskin.Filters.undef("+U+")"),v+=U.length-X.length,o=!1,k){var gb=m.length-1;m[gb]+=U,n[gb]+=X,w+=U.length-X.length}else g=g.substring(0,O+Z)+U+g.substring(O+X.length+Z);O+=X.length-2,Q=1;continue}if(C.test(R)&&(o=!0,p>0&&p--),k){if(")"!==R||i){var hb=m.length-1;m[hb]+=R,n[hb]+=R}}else if(")"===R){if("|"!==S||!D.test(T)){h&&h--,j.shift();continue}l=!0}}if(P="|"===R,Q&&Q--,O===N-1&&h&&")"!==R)throw this.error("Missing closing or opening parenthesis in the template");if(k&&(")"===R&&!i||O===N-1)){for(var ib=j[0],jb=v-w+t,kb=g.substring(ib[0]+(h?t:0),ib[1]+jb),lb=[],mb=0;mb<m.length;mb++)"!html"!==m[mb]?lb.push(m[mb]):h||(x=!0);m=lb;for(var nb=kb,ob=0;ob<m.length;ob++){for(var pb=m[ob].split(" "),qb=pb.slice(1).join("").trim(),rb=pb.shift().split("."),sb="",tb=0;tb<rb.length;tb++)sb+="['"+rb[tb]+"']";nb="($_ = Snakeskin.Filters"+sb+(l||!h?"(":"")+nb+(qb?","+qb:"")+(l||!h?")":"")+")"}var ub=n.join().length+1;g=h?g.substring(0,ib[0]+t)+nb+g.substring(ib[1]+jb+ub):nb,j.shift(),m=[],n=[],k=!1,h&&(h--,l=!1),v+=nb.length-kb.length-ub,h||(t+=v-w,v=0,w=0)}if(")"===R&&i){i--;var vb=m.length-1,wb=m[vb];m[vb]=this.prepareOutput(wb,!0,null,!0),v+=m[vb].length-wb.length,w+=m[vb].length-wb.length}"|"===S&&D.test(T)&&(o=!1,k||(h?j[0].push(O+1):j.push([0,O+1])),k=!0,i||(m.push(T),n.push(T),O+=2))}return(x||b?"":"Snakeskin.Filters.html(")+g+(x||b?"":")")};Snakeskin.addDirective("setBEM",{placement:"global",notEmpty:!0},function(a){this.startInlineDir();var b=a.match(/(.*?),\s+(.*)/);try{A[b[1]]=new Function("return {"+this.pasteDangerBlocks(b[2])+"}")()}catch(c){throw this.error("Invalid syntax")}}),Snakeskin.addDirective("bem",{placement:"template",notEmpty:!0},function(a){if(this.startDir(null,{tag:/^\(/.test(a)?/\((.*?)\)/.exec(a)[1]:null}),this.isSimpleOutput()){var b=this.structure.params;a=b.tag?a.replace(/^.*?\)(.*)/,"$1"):a;var c=a.trim().split(","),d=c[0];b.original=A[d]&&A[d].tag,c[0]+="'",a=c.join(","),this.save("__SNAKESKIN_RESULT__ += '<"+(b.tag||b.original||"div")+' class="i-block" data-params="{name: \\\''+this.replaceTplVars(a.replace(/\s+/g," "))+"}\">';")}},function(){if(this.isSimpleOutput()){var a=this.structure.params;this.save("__SNAKESKIN_RESULT__ += '</"+(a.tag||a.original||"div")+">';")}});Snakeskin.addDirective("block",{placement:"template",sys:!0,notEmpty:!0},function(a){if(this.startDir(null,{name:a}),this.isAdvTest()){if(p[this.tplName][a])throw this.error('Block "'+a+'" is already defined');p[this.tplName][a]={from:this.i-this.startTemplateI+1}}},function(a,b){if(this.isAdvTest()){var c=p[this.tplName][this.structure.params.name];c.to=this.i-this.startTemplateI-b-1,c.content=this.source.substring(this.startTemplateI).substring(c.from,c.to)}});Snakeskin.addDirective("call",{placement:"template",notEmpty:!0},function(a){this.startInlineDir(),this.isSimpleOutput()&&this.save("__SNAKESKIN_RESULT__ += "+this.prepareOutput(a,!0)+";")});Snakeskin.addDirective("const",null,function(a,b){var c=this.tplName,d=/^[@#$a-z_][$\w\[\].'"\s]*([^=]?[+-/*><^]*)=[^=]?/i,e=this.scope.length?d:/^[$a-z_][$\w\[\].'"\s]*([^=]?[+-/*><^]*)=[^=]?/i,f=e.exec(a);if(f&&!f[1]){var g=a.split("=");if(!g[1]||!g[1].trim())throw this.error("Invalid syntax");var h=g[0].trim(),i=h.charAt(0);if("#"===i||"@"===i)throw this.error("Can't declare constant \""+h+'" with the context modifier');if(this.structure.parent){if(this.startInlineDir("const",{name:h}),this.isSimpleOutput()&&this.save(this.prepareOutput((/[.\[]/.test(h)?"":"var ")+a+";",!0)),this.isAdvTest()){if(s[c][h]||u[c][h])throw this.error('Constant "'+h+'" is already defined');if(this.varCache[c][h])throw this.error('Constant "'+h+'" is already defined as variable');if(C[h])throw this.error("Can't declare constant \""+h+'", try another name');s[c][h]={from:this.i-this.startTemplateI-b,to:this.i-this.startTemplateI},t[c]=this.i-this.startTemplateI+1}}else this.startInlineDir("globalVar"),this.save("if (typeof Snakeskin !== 'undefined') { Snakeskin.Vars."+this.prepareOutput(a,!0,null,!0)+"; }")}else{if(!this.structure.parent)throw this.error('Directive "output" can only be used within a "template" or "proto"');if(this.startInlineDir("output"),this.isSimpleOutput()){if(d.test(a))return this.save(this.prepareOutput(a,!0)+";"),void 0;this.save("__SNAKESKIN_RESULT__ += "+this.prepareOutput(a)+";")}}});Snakeskin.addDirective("for",{placement:"template",notEmpty:!0},function(a){if(this.startDir(),this.isSimpleOutput()){var b=a.split(";");if(3!==b.length)throw this.error("Invalid syntax");var c=/var /;this.save("for ("+(c.test(b[0])?this.multiDeclVar(b[0].replace(c,"")):this.prepareOutput(b[0],!0))+this.prepareOutput(b.slice(1).join(";"),!0)+") {")}}),Snakeskin.addDirective("while",{placement:"template",notEmpty:!0},function(a){"do"==this.structure.name?(this.isSimpleOutput()&&this.save("} while ("+this.prepareOutput(a,!0)+");"),Snakeskin.Directions.end(this)):(this.startDir(),this.isSimpleOutput()&&this.save("while ("+this.prepareOutput(a,!0)+") {"))}),Snakeskin.addDirective("repeat",{placement:"template",sys:!0},function(){this.startDir(),this.isSimpleOutput()&&this.save("do {")}),Snakeskin.addDirective("do",{placement:"template",sys:!0},function(){this.startDir(),this.isSimpleOutput()&&this.save("do {")}),Snakeskin.addDirective("until",{placement:"template",notEmpty:!0},function(a){if("repeat"!==this.structure.name)throw this.error('Directive "'+this.name+'" can only be used with a "repeat"');this.isSimpleOutput()&&this.save("} while ("+this.prepareOutput(a,!0)+");"),Snakeskin.Directions.end(this)}),Snakeskin.addDirective("break",{placement:"template"},function(){if(this.startInlineDir(),!this.hasParent({repeat:!0,"while":!0,"do":!0,forEach:!0,forIn:!0}))throw this.error('Directive "'+this.name+'" can only be used with a cycles');this.isSimpleOutput()&&(this.save("break;"),this.space=!0)}),Snakeskin.addDirective("continue",{placement:"template"},function(){if(this.startInlineDir(),!this.hasParent({repeat:!0,"while":!0,"do":!0,forEach:!0,forIn:!0}))throw this.error('Directive "'+this.name+'" can only be used with a cycles');this.isSimpleOutput()&&(this.save("continue;"),this.space=!0)});Snakeskin.addDirective("data",{placement:"template",notEmpty:!0,replacers:{"=":function(a){return a.replace(/^=/,"data ")}}},function(a){this.startInlineDir(),this.isSimpleOutput()&&this.save("__SNAKESKIN_RESULT__ += '"+this.replaceTplVars(a)+"';")}),Snakeskin.addDirective("decl",{placement:"template",notEmpty:!0,replacers:{"{":function(a){return a.replace(/^\{/,"decl ")}}},function(a){if(this.startInlineDir(),this.isSimpleOutput()){a=this.replaceTplVars(a);var b,c=/^\{+/.exec(a)||[""],d=/\}+$/.exec(a)||[""];try{b=new Array(d[0].length-c[0].length+1).join("{")}catch(e){throw this.error("Invalid syntax")}this.save("__SNAKESKIN_RESULT__ += '{"+b+a+"}';")}}),Snakeskin.addDirective("attr",{placement:"template",notEmpty:!0},function(a){if(this.startInlineDir(),this.isSimpleOutput()){var b=a.match(/(.*?),\s+(.*)/);if(!b)throw this.error("Invalid syntax");b[1]="-"===b[1].charAt(0)?"'data-' + "+b[1].slice(1):b[1],b[2]=this.prepareOutput(b[2],!0),this.save("if ("+b[2]+") {__SNAKESKIN_RESULT__ += ' ' + "+b[1]+" + '=\"' + ("+b[2]+") + '\"';}")}});Snakeskin.addDirective("end",{replacers:{"/":function(a){return a.replace(/^\//,"end ")}}},function(a){var b=this.structure;if(!b.parent)throw this.error('Invalid call "end"');if(a&&a!==b.name)throw this.error("Invalid closing tag, expected: "+b.name+", declared: "+a);y[b.name]&&(this.strongDir=null),this.returnStrongDir&&this.returnStrongDir.child===b.name&&(this.strongDir=this.returnStrongDir.dir,this.strongSpace=!0,this.returnStrongDir=null),Snakeskin.Directions[b.name+"End"]?Snakeskin.Directions[b.name+"End"].apply(this,arguments):!b.sys&&this.isSimpleOutput()&&this.save("};"),this.endDir()});Snakeskin.addDirective("super",{placement:"template"},function(a,b){var c={block:!0,proto:!0,"const":!0};if(this.parentTplName){for(var d,e=this.blockStructure;;){if(c[e.name]){switch(e.name){case"proto":d=q[this.parentTplName][e.params.name];break;case"block":d=p[this.parentTplName][e.params.name]}if(d)break}if(!e.parent||"root"===e.parent.name)break;e=e.parent}d&&(this.source=this.source.substring(0,this.i-b-1)+d.content+this.source.substring(this.i+1),this.i-=b+1)}});Snakeskin.addDirective("forEach",{placement:"template",notEmpty:!0},function(a){var b=this;if(this.startDir(),this.isSimpleOutput()){var c=a.split("=>"),d=c[0];if(c.length>2)throw this.error("Invalid syntax");var e=c[1]?c[1].trim().split(","):[],f=this.multiDeclVar("__TMP__ = "+d),g=this.prepareOutput("__TMP__",!0),h="";e.length>=6&&(h+=this.multiDeclVar("__TMP_LENGTH__ = 0")+"for ("+this.multiDeclVar("__KEY__",!1)+"in "+g+") {if (!"+g+".hasOwnProperty("+this.prepareOutput("__KEY__",!0)+")) {continue;}"+this.prepareOutput("__TMP_LENGTH__++;",!0)+"}");var i=f+"if ("+g+") {if (Array.isArray("+g+")) {"+this.multiDeclVar("__TMP_LENGTH__ =  __TMP__.length")+"for ("+this.multiDeclVar("__I__ = -1")+this.prepareOutput("++__I__ < __TMP_LENGTH__;",!0)+") {"+function(){for(var a="",c=0;c<e.length;c++)switch(c){case 0:a+=b.multiDeclVar(e[c]+" = __TMP__[__I__]");break;case 1:a+=b.multiDeclVar(e[c]+" = __I__");break;case 2:a+=b.multiDeclVar(e[c]+" = __TMP__");break;case 3:a+=b.multiDeclVar(e[c]+" = __I__ === 0");break;case 4:a+=b.multiDeclVar(e[c]+" = __I__ === __TMP_LENGTH__ - 1");break;case 5:a+=b.multiDeclVar(e[c]+" = __TMP_LENGTH__")}return a}(),j="} else {"+h+this.multiDeclVar("__I__ = -1")+"for ("+this.multiDeclVar("__KEY__",!1)+"in "+g+") {if (!"+g+".hasOwnProperty("+this.prepareOutput("__KEY__",!0)+")) {continue;}"+this.prepareOutput("__I__++;",!0)+function(){for(var a="",c=0;c<e.length;c++)switch(c){case 0:a+=b.multiDeclVar(e[c]+" = __TMP__[__KEY__]");break;case 1:a+=b.multiDeclVar(e[c]+" = __KEY__");break;case 2:a+=b.multiDeclVar(e[c]+" = __TMP__");break;case 3:a+=b.multiDeclVar(e[c]+" = __I__");break;case 4:a+=b.multiDeclVar(e[c]+" = __I__ === 0");break;case 5:a+=b.multiDeclVar(e[c]+" = __I__ === __TMP_LENGTH__ - 1");break;case 6:a+=b.multiDeclVar(e[c]+" = __TMP_LENGTH__")}return a}();this.save(i),this.structure.params={from:this.res.length,end:j}}},function(){if(this.isSimpleOutput()){var a=this.structure.params;this.save("}"+a.end+this.res.substring(a.from)+"}}}")}}),Snakeskin.addDirective("forIn",{placement:"template",notEmpty:!0},function(a){var b=this;if(this.startDir(),this.isSimpleOutput()){var c=a.split("=>"),d=c[0];if(c.length>2)throw this.error("Invalid syntax");var e=c[1]?c[1].trim().split(","):[],f=this.multiDeclVar("__TMP__ = "+d),g=this.prepareOutput("__TMP__",!0),h="";e.length>=6&&(h+=this.multiDeclVar("__TMP_LENGTH__ = 0")+"for ("+this.multiDeclVar("key",!1)+"in "+g+") {"+this.prepareOutput("__TMP_LENGTH__++;",!0)+"}");var i=f+"if ("+g+") {"+h+this.multiDeclVar("__I__ = -1")+"for ("+this.multiDeclVar("__KEY__",!1)+"in "+g+") {"+this.prepareOutput("__I__++;",!0)+function(){for(var a="",c=0;c<e.length;c++)switch(c){case 0:a+=b.multiDeclVar(e[c]+" = __TMP__[__KEY__]");break;case 1:a+=b.multiDeclVar(e[c]+" = __KEY__");break;case 2:a+=b.multiDeclVar(e[c]+" = __TMP__");break;case 3:a+=b.multiDeclVar(e[c]+" = __I__");break;case 4:a+=b.multiDeclVar(e[c]+" = __I__ === 0");break;case 5:a+=b.multiDeclVar(e[c]+" = __I__ === __TMP_LENGTH__ - 1");break;case 6:a+=b.multiDeclVar(e[c]+" = __TMP_LENGTH__")}return a}();this.save(i)}},function(){this.isSimpleOutput()&&this.save("}}")});Snakeskin.addDirective("if",{placement:"template",notEmpty:!0},function(a){this.startDir(),this.isSimpleOutput()&&this.save("if ("+this.prepareOutput(a,!0)+") {")}),Snakeskin.addDirective("elseIf",{placement:"template",notEmpty:!0},function(a){if("if"!==this.structure.name)throw this.error('Directive "'+this.name+'" can only be used with a "if"');this.isSimpleOutput()&&this.save("} else if ("+this.prepareOutput(a,!0)+") {")}),Snakeskin.addDirective("else",{placement:"template"},function(){if("if"!==this.structure.name)throw this.error('Directive "'+this.name+'" can only be used with a "if"');this.isSimpleOutput()&&this.save("} else {")}),Snakeskin.addDirective("switch",{placement:"template",notEmpty:!0,strongDirs:{"case":!0,"default":!0}},function(a){this.startDir(),this.isSimpleOutput()&&this.save("switch ("+this.prepareOutput(a,!0)+") {")}),Snakeskin.addDirective("case",{placement:"template",notEmpty:!0,replacers:{">":function(a){return a.replace(/^>/,"case ")},"/>":function(a){return a.replace(/^\/>/,"end case")}}},function(a){if(!this.has("switch"))throw this.error('Directive "'+this.name+'" can only be used within a "switch"');this.startDir(),this.isSimpleOutput()&&this.save("case "+this.prepareOutput(a,!0)+": {")},function(){this.isSimpleOutput()&&this.save("} break;")}),Snakeskin.addDirective("default",{placement:"template"},function(){if(!this.has("switch"))throw this.error('Directive "'+this.name+'" can only be used within a "switch"');this.startDir(),this.isSimpleOutput()&&this.save("default: {")});Snakeskin.addDirective("__appendLine__",null,function(a){if(!this.structure.parent)throw this.error('Directive "cdata" can only be used within a "template" or "proto"');this.startInlineDir("cdata"),this.isSimpleOutput(),this.info.line+=parseInt(a)}),Snakeskin.addDirective("__protoWhile__",null,function(a){if(this.startDir(),this.isSimpleOutput()){var b=this.prepareOutput("__I_PROTO__",!0);q[this.tplName][this.proto.name].i=b,this.save(b+":while ("+this.prepareOutput(a,!0)+") {")}});b.prototype.protoStart=!1,b.prototype.preProtos={},b.prototype.protoLink=null,b.prototype.returnArgs=function(a,b){for(var c="",d=0;d<a.length;d++){var e=this.prepareOutput(b[d]||"null",!0),f=a[d][0],g=a[d][1];c+="var "+f+" = "+(void 0!==g?e?"typeof "+e+" !== 'undefined' && "+e+" !== null ? "+e+":"+g:g:e||"void 0")+";"}return c},Snakeskin.addDirective("proto",{sys:!0,notEmpty:!0},function(a,b){var c=a.match(/[^(]+/)[0],d=c.split("->");if(d[1]&&(c=d[1].trim(),this.tplName||(this.tplName=d[0].trim(),this.preProtos[this.tplName]=this.preProtos[this.tplName]||{text:"",line:0},this.preProtos[this.tplName].startLine=this.info.line,this.protoLink=c)),!c||!this.tplName)throw this.error("Invalid syntax");if(this.startDir(null,{name:c,startTemplateI:this.i+1,from:this.i-b-1}),this.isAdvTest()){if(q[this.tplName][c])throw this.error('Proto "'+c+'" is already defined');var e=a.match(/\((.*?)\)/),f=[];if(e)for(var g=e[1].split(","),h=0;h<g.length;h++){var i=g[h].split("=");i[0]=this.declVar(i[0].trim()),f.push(i)}q[this.tplName][c]={length:b,from:this.i-this.startTemplateI+1,argsDecl:e?e[0]:"",args:f,calls:{}}}this.parentTplName||(this.protoStart=!0)},function(a,b){var c=this.tplName,d=this.structure.params;if(this.protoLink===d.name){var e=this.preProtos[this.tplName];e.text+=this.source.substring(d.from,this.i+1),e.line+=this.info.line-e.startLine,this.protoLink=null,this.tplName=null,this.hasParentBlock("proto")||(this.protoStart=!1)}else if(!this.protoLink){var f=q[c][d.name];this.isAdvTest()&&(f.to=this.i-this.startTemplateI-b-1,f.content=this.source.substring(this.startTemplateI).substring(f.from,f.to),r[c]=this.i-this.startTemplateI+1,f.body=Snakeskin.compile("{template "+c+"()}{var __I_PROTO__ = 1}{__protoWhile__ __I_PROTO__--}"+this.source.substring(d.startTemplateI,this.i-b-1)+"{end}{end}",null,null,{scope:this.scope,vars:this.structure.vars,proto:{name:d.name,parentTplName:this.parentTplName,pos:this.res.length,ctx:this}}));
var g=this.backTable[d.name];if(g&&!g.protoStart){for(var h=f.args,i=!0,j=0;j<g.length;j++){var k=g[j];if(this.canWrite)if(k.outer){var l=this.structure.vars;this.structure.vars=k.vars,k.argsStr=this.returnArgs(h,k.args),this.structure.vars=l,i=!1}else this.res=this.res.substring(0,k.pos)+this.returnArgs(h,k.args)+q[c][d.name].body+this.res.substring(k.pos)}i&&(delete this.backTable[d.name],this.backTableI--)}}this.protoLink&&this.protoLink!==d.name||this.hasParentBlock("proto")||(this.protoStart=!1)}),b.prototype.backTable={init:function(){return{}}},b.prototype.backTableI=0,Snakeskin.addDirective("apply",{placement:"template",notEmpty:!0},function(a){if(this.startInlineDir(),this.isSimpleOutput()){var b=/[^(]+/.exec(a)[0],c=/\((.*?)\)/.exec(a),d=q[this.tplName],e=d[b],f="";e&&(f=this.returnArgs(e.args,c?c[1].split(","):[]));var g,h=this.proto;if(h&&(g=e&&e.calls[h.name]),this.proto&&this.proto.name===b)this.save(f+this.prepareOutput("__I_PROTO__++",!0)+";");else if(e&&e.body&&!g)this.save(f+e.body);else{this.backTable[b]||(this.backTable[b]=[],this.backTable[b].protoStart=this.protoStart,this.backTableI++);var i=Math.random()+"";this.backTable[b].push({proto:h?d[h.name]:null,pos:this.res.length,label:new RegExp("\\/\\* __APPLY__"+this.tplName+"_"+b+"_"+i.replace(".","\\.")+" \\*\\/"),args:c,recursive:!!e||!!g}),this.save("/* __APPLY__"+this.tplName+"_"+b+"_"+i+" */"),h&&!e&&(d[h.name].calls[b]=!0)}}});Snakeskin.addDirective("return",{placement:"template"},function(a){this.startInlineDir(),this.isSimpleOutput()&&(this.space=!0,this.proto?this.save(this.prepareOutput("break __I_PROTO__;",!0)):a?this.save(this.prepareOutput("return "+a+";",!0)):this.save("return __SNAKESKIN_RESULT__;"))});Snakeskin.addDirective("with",{placement:"template",sys:!0,notEmpty:!0},function(a){this.startDir(),this.scope.push(a)},function(){this.scope.pop()});Snakeskin.addDirective("&",{placement:"template"},function(){this.startInlineDir(),this.isSimpleOutput()&&(this.space=!0)});b.prototype.startTemplateI=0,b.prototype.startTemplateLine=null,b.prototype.tplName=null,b.prototype.parentTplName=null;var J,K;Snakeskin.addDirective("template",{placement:"global",notEmpty:!0},J=function(b){this.startDir(),this.startTemplateI=this.i+1,this.startTemplateLine=this.info.line;try{var c=/(.*?)\(/.exec(b)[1],d=this.pasteDangerBlocks(c)}catch(e){throw this.error("Invalid syntax")}if(!d)throw this.error("Invalid syntax");if(this.info.template=d,"placeholder"===this.name&&(B[d]||(B[d]=!1)),this.tplName=d,this.blockStructure={name:"root",parent:null,childs:[]},this.blockTable={},this.varCache[d]={},!this.proto){var f;if(/\s+extends\s+/m.test(b)){try{f=this.pasteDangerBlocks(/\s+extends\s+(.*)/m.exec(b)[1]),this.parentTplName=f}catch(e){throw this.error("Invalid syntax")}if(void 0===n[f])throw this.error('The specified template ("'+f+'" -> "'+d+'") for inheritance is not defined')}this.initTemplateCache(d),w[d]=f;try{var g=/\((.*?)\)/.exec(b)[1]}catch(e){throw this.error("Invalid syntax")}if(this.save("/* Snakeskin template: "+d+"; "+g.replace(/=(.*?)(?:,|$)/g,"")+" */"),/\.|\[/m.test(c)||this.commonJS){for(var h="",i=/^__ESCAPER_QUOT__\d+_/,j=c.replace(/\[/gm,".").replace(/]/gm,"").split("."),k=j[0],l=j.length,m=1;l>m;m++){var o=j[m];this.save("if (typeof "+(this.commonJS?"exports.":"")+k+" === 'undefined') { "+(this.commonJS?"exports.":1===m?a?"var ":"window.":"")+k+" = {};}"),i.test(o)?k+="["+o+"]":(m===l-1&&(h=o),k+="."+o)}this.save((this.commonJS?"exports.":"")+c+"= function "+h+"(")}else this.save((a?"":"window."+c+" = ")+"function "+c+"(");for(var p=g.split(","),q=v[f],r=v[d]={},s=0;s<p.length;s++){var t=p[s].split("=");t[0]=t[0].trim(),r[t[0]]={i:s,key:t[0],value:t[1]&&t[1].trim()}}if(q)for(var x in q)if(q.hasOwnProperty(x)){var y=q[x],z=r[x];void 0!==y.value&&(r[x]?z&&void 0===z.value&&(r[x].value=y.value):r[x]={local:!0,i:y.i,key:x,value:y.value})}p=[];var A=[];for(var C in r)if(r.hasOwnProperty(C)){var D=r[C];D.local?A[D.i]=D:p[D.i]=D}for(var E="",F=0;F<p.length;F++){var G=p[F];this.save(G.key),u[d][G.key]=G,void 0!==G.value&&(E+=G.key+" = "+G.key+" !== void 0 && "+G.key+" !== null ? "+G.key+" : "+G.value+";"),F!==p.length-1&&this.save(",")}for(var H=0;H<A.length;H++){var I=A[H];I&&(E+="var "+I.key+" = "+I.value+";",u[d][I.key]=I)}this.save(") { "+E+"var __SNAKESKIN_RESULT__ = '', $_;"),this.save("var TPL_NAME = '"+this.applyDefEscape(this.pasteDangerBlocks(c))+"';var PARENT_TPL_NAME;"),f&&this.save("PARENT_TPL_NAME = '"+this.applyDefEscape(this.pasteDangerBlocks(f))+"';"),w[d]&&!f||!this.preProtos[d]||(this.source=this.source.substring(0,this.i+1)+this.preProtos[d].text+this.source.substring(this.i+1),this.info.line-=this.preProtos[d].line,this.preProtos[d]=null)}},K=function(a,b){var c=this.tplName;if(this.backTableI&&this.proto){var d=Object(this.backTable),e=this.proto.ctx;e.backTableI+=this.backTableI;for(var f in d)if(d.hasOwnProperty(f)){for(var g=0;g<d[f].length;g++){var h=d[f][g];h.pos+=this.proto.pos,h.outer=!0,h.vars=this.structure.vars}e.backTable[f]=e.backTable[f]?e.backTable[f].concat(d[f]):d[f]}}if(!this.proto){if(n[c]=this.source.substring(this.startTemplateI,this.i-b-1),o[c]=this.blockTable,this.parentTplName)return this.info.line=this.startTemplateLine,this.source=this.source.substring(0,this.startTemplateI)+this.getExtStr(c)+this.source.substring(this.i-b-1),this.initTemplateCache(c),this.startDir(this.structure.name),this.i=this.startTemplateI-1,this.parentTplName=null,void 0;if(this.backTableI){var i=Object(this.backTable);for(var j in i)if(i.hasOwnProperty(j))for(var k=0;k<i[j].length;k++){var l=i[j][k];if(l.outer){var m=q[c][j];if(!m)throw this.error('Proto "'+j+'" is not defined');this.res=this.res.substring(0,l.pos)+this.res.substring(l.pos).replace(l.label,(l.argsStr||"")+(l.recursive?m.i+"++;":m.body))}}}this.save("return __SNAKESKIN_RESULT__; };if (typeof Snakeskin !== 'undefined') {Snakeskin.cache['"+this.applyDefEscape(this.pasteDangerBlocks(c))+"'] = "+(this.commonJS?"exports.":"")+c+";}/* Snakeskin template. */"),this.canWrite=!0,this.tplName=null,delete this.info.template}}),Snakeskin.addDirective("placeholder",{placement:"global",notEmpty:!0},J,K);Snakeskin.addDirective("try",{placement:"template"},function(){this.startDir(),this.isSimpleOutput()&&this.save("try {")}),Snakeskin.addDirective("catch",{placement:"template",notEmpty:!0},function(a){if("try"!==this.structure.name)throw this.error('Directive "'+this.name+'" can only be used with a "try"');this.isSimpleOutput()&&this.save("} catch ("+this.declVar(a)+") {")}),Snakeskin.addDirective("finally",{placement:"template"},function(){if("try"!==this.structure.name)throw this.error('Directive "'+this.name+'" can only be used with a "try"');this.isSimpleOutput()&&this.save("} finally {")});b.prototype.varCache={init:function(){return{}}},Snakeskin.addDirective("var",{placement:"template",notEmpty:!0,replacers:{":":function(a){return a.replace(/^:/,"var ")}}},function(a){this.startInlineDir(),this.isSimpleOutput()&&this.save(this.multiDeclVar(a))});Snakeskin.addDirective("void",{placement:"template",notEmpty:!0,replacers:{"?":function(a){return a.replace(/^\?/,"void ")}}},function(a){if(/(?:^|\s+)(?:var|const|let) /.test(a))throw this.error('Can\'t declare variables within "void"');this.startInlineDir(),this.isSimpleOutput()&&this.save(this.prepareOutput(a,!0)+";")}),a&&(module.exports=Snakeskin)}("undefined"==typeof window);