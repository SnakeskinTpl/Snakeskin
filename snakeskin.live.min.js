var Snakeskin={VERSION:"2.0",Directions:{},Filters:{},BEM:{},Vars:{},write:{},cache:{}},SS=Snakeskin;
(function(u){Array.isArray||(Array.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)});String.prototype.trim||(String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),c=b.length;/\s/.test(b.charAt(--c)););return b.substring(0,c+1)});Snakeskin.forEach=function(b,c){var a=-1,e,d;if(Array.isArray(b))for(e=b.length;++a<e&&!1!==c(b[a],a,0===a,a===e-1,e););else{a=0;for(d in b)b.hasOwnProperty(d)&&a++;e=a;a=-1;for(d in b)if(b.hasOwnProperty(d)&&(a++,!1===c(b[d],
d,a,0===a,a===e-1,e)))break}};var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},F=/[&<>"'\/]/g,G=function(b){return E[b]};Snakeskin.Filters.html=function(b){return String(b).replace(F,G)};Snakeskin.Filters.undef=function(b){return"undefined"!==typeof b?b:""};var H={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"},I=/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,J=function(b){return H[b]};Snakeskin.Filters.uhtml=function(b){return String(b).replace(I,J)};
var K=/<\/?[^>]+>/g;Snakeskin.Filters.stripTags=function(b){return String(b).replace(K,"")};var L=/%5B/g,M=/%5D/g;Snakeskin.Filters.uri=function(b){return encodeURI(String(b)).replace(L,"[").replace(M,"]")};Snakeskin.Filters.upper=function(b){return String(b).toUpperCase()};Snakeskin.Filters.ucfirst=function(b){b=String(b);return b.charAt(0).toUpperCase()+b.substring(1)};Snakeskin.Filters.lower=function(b){return String(b).toLowerCase()};Snakeskin.Filters.lcfirst=function(b){b=String(b);return b.charAt(0).toLowerCase()+
b.substring(1)};Snakeskin.Filters.trim=function(b){return String(b).trim()};var N=/\s{2,}/g;Snakeskin.Filters.collapse=function(b){return String(b).replace(N," ").trim()};Snakeskin.Filters.truncate=function(b,c,a){b=String(b);if(!b||b.length<=c)return b;b=b.substring(0,c-1);var e;for(c=b.length;c--&&a;)if(" "===b.charAt(c))e=c;else if("undefined"!==typeof e)break;return("undefined"!==typeof e?b.substring(0,e):b)+"\u2026"};Snakeskin.Filters.repeat=function(b,c){return Array(c||2).join(b)};Snakeskin.Filters.remove=
function(b,c){return String(b).replace(c,"")};Snakeskin.Filters.replace=function(b,c,a){return String(b).replace(c,a)};Array.prototype.reduce||(Array.prototype.reduce=function(b,c){var a=0,e=this.length,d;if(1===e)return this[0];for(d="undefined"!==typeof c?c:this[0];++a<e;)d=b(d,this[a],a,this);return d});var s={},n={},m={},v={},C={},p={},w={},t={},q={},x={},z=[],O={'"':!0,"'":!0},P={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_CDATA__:!0};Snakeskin._escape=function(b,c){return b.replace(/(["']).*?[^\\]\1/g,
function(a){c&&c.push(a);return"__SNAKESKIN_QUOT__"+(c?c.length-1:"_")})};Snakeskin._uescape=function(b,c){return b.replace(/__SNAKESKIN_QUOT__(\d+)/g,function(a,b){return c[b]})};Snakeskin._getExtStr=function(b,c){if("undefined"===typeof s[x[b]])throw this.error('The specified pattern ("'+x[b]+'" for "'+b+'") for inheritance is not defined ('+this._genErrorAdvInfo(c)+")!");for(var a=x[b],e=s[a],d,h,g,f,j=-1,l,k=0,A=[],B,D,r;6>++j;)for(f in 0===j?(d=n[b],h=n[a]):2===j?(d=p[b],h=p[a],k=w[a],l=null):
4===j&&(d=m[b],h=m[a],k=v[a],l=null),d)if(d.hasOwnProperty(f))if(r=0,g=s[b].substring(d[f].from,d[f].to),h[f]&&(B=g.length-s[a].substring(h[f].from,h[f].to).length),D=h[f]?h[f].from:k,A.sort(function(a,b){if(a.val>b.val)return 1;if(a.val===b.val)return 0;if(a.val<b.val)return-1}).some(function(a){if(a.val<D)r+=a.adv;else return!0}),h[f]&&0===j%2)1<j&&(l=h[f].from+r+g.length,k+=B,l>k&&(k=l+(4===j?5:1))),e=e.substring(0,h[f].from+r)+g+e.substring(h[f].to+r),A.push({val:h[f].from,adv:B});else if(!h[f])if(1===
j)e+="{"+f+"}"+g+"{end}";else if(3===j||5===j)null===l&&(l=k,k+=r),g=3===j?"{"+g+"}":"{"+f+"}"+g+"{end}",e=e.substring(0,k)+g+e.substring(k),A.push({val:l,adv:g.length}),k+=g.length;return e};Snakeskin._genErrorAdvInfo=function(b){var c,a="";for(c in b)b.hasOwnProperty(c)&&(a=b[c].innerHTML?a+(c+": (class: "+(b[c].className||"undefined")+", id: "+(b[c].id||"undefined")+"), "):a+(c+": "+b[c]+", "));return a.replace(/, $/,"")};Snakeskin.error=function(b){b=Error(b);b.name="Snakeskin Error";return b};
Snakeskin.compile=function(b,c,a,e){e=e||{};b.innerHTML&&(e.node=b);b={i:-1,openBlockI:0,nmCache:{},posCache:{},sysPosCache:{},backHashI:0,backHash:{},lastBack:null,quotContent:[],source:String(b.innerHTML||b).replace(/{cdata}([\s\S]*?){end\s+cdata}/gm,function(a,b){z.push(b);return"__SNAKESKIN_CDATA__"+(z.length-1)}).replace(/\/\/.*/gm,"").replace(/[\t\v\r\n]/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),res:""+(!a?"/* This code is generated automatically, don't alter it. */":"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);exec();return this;};function exec() {":
""),save:function(a){this.canWrite&&(this.res+=a)},replace:function(a){this.canWrite&&(this.res=a)},pushPos:function(a,b,c){c?(this.sysPosCache[a]||(this.sysPosCache[a]=[]),this.sysPosCache[a].push(b)):(this.posCache[a]||(this.posCache[a]=[]),this.posCache[a].push(b))},popPos:function(a){this.sysPosCache[a]?this.sysPosCache[a].pop():this.posCache[a].pop()},getPos:function(a){return this.sysPosCache[a]?this.sysPosCache[a]:this.posCache[a]},hasPos:function(a){return this.sysPosCache[a]?this.sysPosCache[a].length:
!(!this.posCache[a]||!this.posCache[a].length)},getLastPos:function(a){if(this.sysPosCache[a]){if(this.sysPosCache[a].length)return this.sysPosCache[a][this.sysPosCache[a].length-1]}else if(this.posCache[a]&&this.posCache[a].length)return this.posCache[a][this.posCache[a].length-1]},isNotSysPos:function(a){var b=this,c=!0;Snakeskin.forEach(this.sysPosCache,function(d,j){if((d=b.getLastPos(j))&&("undefined"!==typeof d.i&&d.i===a||d===a))return c=!1});return c}};for(var d,h=0,g,f="",j,l,k;++b.i<b.source.length;){j=
b.source.charAt(b.i);if(!k)if("{"===j)if(d)h++;else{d=!0;continue}else if("}"===j&&(!h||!h--)){d=!1;l=f.length;f=this._escape(f,b.quotContent).trim();j=f.split(" ")[0];j=this.Directions[j]?j:"const";f=this.Directions[j].call(this,"const"!==j?f.replace(RegExp("^"+j+"\\s+"),""):f,l,b,{commonJS:c,dryRun:a,info:e});!1===f&&(g=d=!1);f="";continue}if(d){!b.protoStart&&g&&(b.save("';"),g=!1);if((O[j]||"/"===j)&&(!b.source[b.i-1]||"\\"!==b.source[b.i-1]))k&&k===j?k=!1:k||(k=j);f+=j}else b.protoStart||(g||
(b.save("__SNAKESKIN_RESULT__ += '"),g=!0),b.parentTplName||b.save(j))}b.res=this._uescape(b.res,b.quotContent).replace(/__SNAKESKIN_ESCAPE__OR/g,"||").replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return z[b].replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\v/gm,"\\v").replace(/'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");b.res+=!a?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";b.res+=c?"}":"";if(a)return b.res;console.log(b.res);return b.res};
Snakeskin.Directions.template=function(b,c,a,e){var d,h,g,f="";a.startI=a.i+1;c=/(.*?)\(/.exec(b)[1];a.tplName=d=this._uescape(c,a.quotContent);if(0!==a.openBlockI)throw this.error("Missing closing or opening tag in the template (command: {"+b+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');a.openBlockI++;a.canWrite=!1!==this.write[d];e.dryRun||(/\s+extends\s+/.test(b)&&(a.parentTplName=h=this._uescape(/\s+extends\s+(.*)/.exec(b)[1],a.quotContent)),n[d]={},m[d]={},v[d]=0,p[d]={},w[d]=
0,t[d]={},x[d]=h,g=/\((.*?)\)/.exec(b)[1],a.save("/* Snakeskin template: "+d+"; "+g.replace(/=(.*?)(?:,|$)/g,"")+" */"),/\.|\[/.test(c)||e.commonJS?(c.replace(/\[/g,".").replace(/]/g,"").split(".").reduce(function(b,c,d){nmCache[b]||(a.save("if (typeof "+(opt_commonjs?"exports.":"")+b+" === 'undefined') { "+(opt_commonjs?"exports.":1===d?u?"var ":"window.":"")+b+" = {}; }"),nmCache[b]=!0);return"__SNAKESKIN_QUOT__"===c.substring(0,18)?b+"["+c+"]":b+"."+c}),a.save((opt_commonjs?"exports.":"")+c+"= function (")):
a.save((!u?"window."+c+" = ":"")+"function "+(u?c:"")+"("),g=g.split(","),q[d]=q[h]?q[h].concat(g):g,q[h]&&q[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();g.forEach(function(c,d){var f=c.split("=");f[0]=f[0].trim();f[1]=f[1]&&f[1].trim();b[0]===f[0]&&"undefined"===typeof f[1]&&(g[d]=a)})}),g.forEach(function(b,c){var e=b.split("=");e[0]=e[0].trim();a.save(e[0]);1<e.length&&(q[h]&&!f&&q[h].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();
!g.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})&&"undefined"!==typeof b[1]&&(f+="var "+b[0]+" = "+b[1]+";",t[d][b[0]]=a)}),e[1]=e[1].trim(),f+=e[0]+" = typeof "+e[0]+" !== 'undefined' && "+e[0]+" !== null ? "+e[0]+" : "+e[1]+";");t[d][e[0]]=b;c!==g.length-1&&a.save(",")}),a.save(") { "+f+"var __SNAKESKIN_RESULT__ = '';"))};Snakeskin.Directions.templateEnd=function(b,c,a,e){var d=a.tplName,h=a.parentTplName,g=a.source,f=a.i,j=a.startI;if(a.backHashI)throw this.error('Proto "'+
a.lastBack+'" is not defined (command: {'+b+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');if(!e.dryRun){s[d]=g.substring(j,f-c-1);if(h)return a.source=g.substring(0,j)+this._getExtStr(d,e.info)+g.substring(f-c-1),n[d]={},m[d]={},v[d]=0,p[d]={},w[d]=0,t[d]={},a.i=j-1,a.openBlockI++,!1===this.write[h]&&(a.res=a.res.replace(RegExp("/\\* Snakeskin template: "+h.replace(/([.\[\]^$])/g,"\\$1")+";[\\s\\S]*?/\\* Snakeskin template\\. \\*/","m"),"")),a.parentTplName=!1;a.save("return __SNAKESKIN_RESULT__; };if (typeof Snakeskin !== 'undefined') {Snakeskin.cache['"+
this._uescape(d,a.quotContent).replace(/'/g,"\\'")+"'] = "+(e.commonJS?"exports.":"")+d+";}/* Snakeskin template. */");a.canWrite=!0;a.tplName=null}};Snakeskin.Directions.block=function(b,c,a,e){c=a.tplName;if(!e.dryRun&&(a.parentTplName&&!a.hasPos("block")&&!a.hasPos("proto")||!a.parentTplName)){if(n[c][b])throw this.error('Block "'+b+'" is already defined (command: {block '+b+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+'")!');n[c][b]={from:a.i-a.startI+1}}a.pushPos("block",{name:b,i:++a.openBlockI},
!0)};Snakeskin.Directions.blockEnd=function(b,c,a,e){b=a.getLastPos("block");a.popPos("block");if(!e.dryRun&&(a.parentTplName&&!a.hasPos("block")&&!a.hasPos("proto")||!a.parentTplName))n[a.tplName][b.name].to=a.i-a.startI-c-1};Snakeskin.Directions.proto=function(b,c,a,e){c=a.tplName;var d=a.parentTplName;if(!e.dryRun&&(d&&!a.hasPos("block")&&!a.hasPos("proto")||!d)){if(m[c][b])throw this.error('Proto "'+b+'" is already defined (command: {proto'+b+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+
'")!');m[c][b]={from:a.i-a.startI+1}}a.pushPos("proto",{name:b,i:++a.openBlockI,startI:a.i+1},!0);d||(a.protoStart=!0)};Snakeskin.Directions.protoEnd=function(b,c,a,e){var d=a.tplName;b=a.parentTplName;var h=a.i,g=a.backHash,f=a.getLastPos("proto");a.popPos("proto");if(!e.dryRun&&(b&&!a.hasPos("block")&&!a.hasPos("proto")||!b))m[d][f.name].to=h-a.startI-c-1,v[d]=h-a.startI+1;b||(m[d][f.name].body=this.compile("{template "+d+"()}"+a.source.substring(f.startI,h-c-1)+"{end}",null,!0));g[f.name]&&!g[f.name].protoStart&&
(this.forEach(g[f.name],function(b){a.replace(a.res.substring(0,b)+m[d][f.name].body+a.res.substring(b))}),delete g[f.name],a.backHashI--);a.hasPos("proto")||(a.protoStart=!1)};Snakeskin.Directions.apply=function(b,c,a){!a.parentTplName&&!a.hasPos("proto")&&(m[a.tplName][b]?a.save(m[a.tplName][b].body):(a.backHash[b]||(a.backHash[b]=[],a.backHash[b].protoStart=a.protoStart,a.lastBack=b,a.backHashI++),a.backHash[b].push(a.res.length)))};Snakeskin.Directions.forEach=function(b,c,a){a.pushPos("forEach",
++a.openBlockI);!a.parentTplName&&!a.protoStart&&(c=b.split("=>"),a.save(b[0]+" && Snakeskin.forEach("+c[0]+", function ("+(c[1]||"")+") {"))};Snakeskin.Directions.forEachEnd=function(b,c,a){a.popPos("forEach");!a.parentTplName&&!a.protoStart&&a.save("});")};Snakeskin.Directions["if"]=function(b,c,a){a.openBlockI++;!a.parentTplName&&!a.protoStart&&a.save("if ("+b+") {")};Snakeskin.Directions.elseIf=function(b,c,a){!a.parentTplName&&!a.protoStart&&a.save("} else if ("+b+") {")};Snakeskin.Directions["else"]=
function(b,c,a){!a.parentTplName&&!a.protoStart&&a.save("} else {")};Snakeskin.Directions["with"]=function(b,c,a){a.pushPos("with",{scope:b,i:++a.openBlockI},!0)};Snakeskin.Directions.withEnd=function(b,c,a){a.popPos("with")};Snakeskin.Directions["const"]=function(b,c,a,e){var d,h=a.tplName,g=a.parentTplName,f=a.protoStart,j=a.i,l=a.startI;if(!g&&!f&&/console\./.test(b))a.save(b+";");else if(/=(?!=)/.test(b))if(d=b.split("=")[0].trim(),h){if(p[h][d]||t[h][d])throw this.error('Variable "'+d+'" is already defined (command: {'+
b+'}, template: "'+h+", "+this._genErrorAdvInfo(e.info)+'")!');if(P[d])throw this.error("Can't declare variable \""+d+'", try another name (command: {'+b+'}, template: "'+h+", "+this._genErrorAdvInfo(e.info)+'")!');if(a.hasPos("forEach"))throw this.error('Variable "'+d+"\" can't be defined in a loop (command: {"+b+'}, template: "'+h+", "+this._genErrorAdvInfo(e.info)+'")!');p[h][d]={from:j-l-c,to:j-l};w[h]=j-l+1;!g&&!f&&a.save("var "+b+";")}else C[d]=!0,a.save("if (typeof Snakeskin !== 'undefined') { Snakeskin.Vars."+
b+"; }");else!g&&!f&&a.save("__SNAKESKIN_RESULT__ += "+this._returnVar(b,a)+";")};Snakeskin._returnVar=function(b,c){var a="",e=!1;this.forEach(b.replace(/\|\|/g,"__SNAKESKIN_ESCAPE__OR").split("|"),function(b,h){var g,f;0===h?(c.hasPos("with")?(c.pushPos("with",{scope:b}),a=c.getPos("with").reduce(function(a,b){return("undefined"===typeof a.scope?a:a.scope)+"."+b.scope}),c.popPos("with")):a=b,a="Snakeskin.Filters.undef("+(!p[c.tplName][a]&&C[a]?"Snakeskin.Vars.":"")+a+")"):(g=b.split(" "),f=g.slice(1),
"!html"!==g[0]?a="Snakeskin.Filters['"+g[0]+"']("+a+(f.length?", "+f.join(""):"")+")":e=!0)});return(!e?"Snakeskin.Filters.html(":"")+a+(!e?")":"")};Snakeskin.Directions.cut=function(b,c,a){b=this._uescape(b,a.quotContent);this.write[b]||(this.write[b]=!1)};Snakeskin.Directions.save=function(b,c,a){this.write[this._uescape(b,a.quotContent)]=!0};Snakeskin.Directions.end=function(b,c,a,e){a.openBlockI--;var d=this,h=arguments,g=a.openBlockI+1,f;0===a.openBlockI?this.Directions.templateEnd.apply(this,
arguments):a.isNotSysPos(g)&&(this.forEach(a.posCache,function(b,c){if((b=a.getLastPos(c))&&("undefined"!==typeof b.i&&b.i===g||b===g))return f=!0,d.Directions[c+"End"].apply(d,h),!1}),!f&&(!a.parentTplName&&!a.protoStart)&&a.save("};"));this.forEach(a.sysPosCache,function(b,c){if((b=a.getLastPos(c))&&("undefined"!==typeof b.i&&b.i===g||b===g))return d.Directions[c+"End"].apply(d,h),!1})};var y;if(u)for(y in Snakeskin)Snakeskin.hasOwnProperty(y)&&(exports[y]=Snakeskin[y])})("undefined"===typeof window);
