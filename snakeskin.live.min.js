var Snakeskin={VERSION:"2.0",Directions:{},Filters:{},BEM:{},Vars:{},write:{},cache:{}},SS=Snakeskin;
(function(s){Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});String.prototype.trim||(String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),c=a.length;/\s/.test(a.charAt(--c)););return a.substring(0,c+1)});Snakeskin.forEach=function(a,c){var b=-1,e,d;if(Array.isArray(a))for(e=a.length;++b<e&&!1!==c(a[b],b,0===b,b===e-1,e););else{b=0;for(d in a)a.hasOwnProperty(d)&&b++;e=b;b=-1;for(d in a)if(a.hasOwnProperty(d)&&(b++,!1===c(a[d],
d,b,0===b,b===e-1,e)))break}};var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},F=/[&<>"'\/]/g,G=function(a){return E[a]};Snakeskin.Filters.html=function(a){return String(a).replace(F,G)};Snakeskin.Filters.undef=function(a){return"undefined"!==typeof a?a:""};var H={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"},I=/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,J=function(a){return H[a]};Snakeskin.Filters.uhtml=function(a){return String(a).replace(I,J)};
var K=/<\/?[^>]+>/g;Snakeskin.Filters.stripTags=function(a){return String(a).replace(K,"")};var L=/%5B/g,M=/%5D/g;Snakeskin.Filters.uri=function(a){return encodeURI(String(a)).replace(L,"[").replace(M,"]")};Snakeskin.Filters.upper=function(a){return String(a).toUpperCase()};Snakeskin.Filters.ucfirst=function(a){a=String(a);return a.charAt(0).toUpperCase()+a.substring(1)};Snakeskin.Filters.lower=function(a){return String(a).toLowerCase()};Snakeskin.Filters.lcfirst=function(a){a=String(a);return a.charAt(0).toLowerCase()+
a.substring(1)};Snakeskin.Filters.trim=function(a){return String(a).trim()};var N=/\s{2,}/g;Snakeskin.Filters.collapse=function(a){return String(a).replace(N," ").trim()};Snakeskin.Filters.truncate=function(a,c,b){a=String(a);if(!a||a.length<=c)return a;a=a.substring(0,c-1);var e;for(c=a.length;c--&&b;)if(" "===a.charAt(c))e=c;else if("undefined"!==typeof e)break;return("undefined"!==typeof e?a.substring(0,e):a)+"\u2026"};Snakeskin.Filters.repeat=function(a,c){return Array(c||2).join(a)};Snakeskin.Filters.remove=
function(a,c){return String(a).replace(c,"")};Snakeskin.Filters.replace=function(a,c,b){return String(a).replace(c,b)};Array.prototype.reduce||(Array.prototype.reduce=function(a,c){var b=0,e=this.length,d;if(1===e)return this[0];for(d="undefined"!==typeof c?c:this[0];++b<e;)d=a(d,this[b],b,this);return d});var t={},n={},m={},v={},C={},p={},w={},u={},q={},x={},z=[],O={'"':!0,"'":!0},P={__SNAKESKIN_RESULT__:!0,__SNAKESKIN_CDATA__:!0};Snakeskin._escape=function(a,c){return a.replace(/(["']).*?[^\\]\1/g,
function(b){c&&c.push(b);return"__SNAKESKIN_QUOT__"+(c?c.length-1:"_")})};Snakeskin._uescape=function(a,c){return a.replace(/__SNAKESKIN_QUOT__(\d+)/g,function(b,a){return c[a]})};Snakeskin._getExtStr=function(a,c){if("undefined"===typeof t[x[a]])throw this.error('The specified pattern ("'+x[a]+'" for "'+a+'") for inheritance is not defined ('+this._genErrorAdvInfo(c)+")!");for(var b=x[a],e=t[b],d,f,h,g,j=-1,l,k=0,A=[],B,D,r;6>++j;)for(g in 0===j?(d=n[a],f=n[b]):2===j?(d=p[a],f=p[b],k=w[b],l=null):
4===j&&(d=m[a],f=m[b],k=v[b],l=null),d)if(d.hasOwnProperty(g))if(r=0,h=t[a].substring(d[g].from,d[g].to),f[g]&&(B=h.length-t[b].substring(f[g].from,f[g].to).length),D=f[g]?f[g].from:k,A.sort(function(a,b){if(a.val>b.val)return 1;if(a.val===b.val)return 0;if(a.val<b.val)return-1}).some(function(a){if(a.val<D)r+=a.adv;else return!0}),f[g]&&0===j%2)1<j&&(l=f[g].from+r+h.length,k+=B,l>k&&(k=l+(4===j?5:1))),e=e.substring(0,f[g].from+r)+h+e.substring(f[g].to+r),A.push({val:f[g].from,adv:B});else if(!f[g])if(1===
j)e+="{block "+g+"}"+h+"{end}";else if(3===j||5===j)null===l&&(l=k,k+=r),h=3===j?"{"+h+"}":"{proto "+g+"}"+h+"{end}",e=e.substring(0,k)+h+e.substring(k),A.push({val:l,adv:h.length}),k+=h.length;return e};Snakeskin._genErrorAdvInfo=function(a){var c,b="";for(c in a)a.hasOwnProperty(c)&&(b=a[c].innerHTML?b+(c+": (class: "+(a[c].className||"undefined")+", id: "+(a[c].id||"undefined")+"), "):b+(c+": "+a[c]+", "));return b.replace(/, $/,"")};Snakeskin.error=function(a){a=Error(a);a.name="Snakeskin Error";
return a};Snakeskin.compile=function(a,c,b,e){e=e||{};a.innerHTML&&(e.node=a);a={i:-1,openBlockI:0,nmCache:{},posCache:{},sysPosCache:{},backHashI:0,backHash:{},lastBack:null,quotContent:[],source:String(a.innerHTML||a).replace(/{cdata}([\s\S]*?){end\s+cdata}/gm,function(a,b){z.push(b);return"__SNAKESKIN_CDATA__"+(z.length-1)}).replace(/\/\/.*/gm,"").replace(/[\t\v\r\n]/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),res:""+(!b?"/* This code is generated automatically, don't alter it. */":"")+(c?"var Snakeskin = global.Snakeskin;exports.liveInit = function (path) { Snakeskin = require(path);exec();return this;};function exec() {":
""),save:function(a){this.canWrite&&(this.res+=a)},replace:function(a){this.canWrite&&(this.res=a)},pushPos:function(a,b,c){c?(this.sysPosCache[a]||(this.sysPosCache[a]=[]),this.sysPosCache[a].push(b)):(this.posCache[a]||(this.posCache[a]=[]),this.posCache[a].push(b))},popPos:function(a){this.sysPosCache[a]?this.sysPosCache[a].pop():this.posCache[a].pop()},getPos:function(a){return this.sysPosCache[a]?this.sysPosCache[a]:this.posCache[a]},hasPos:function(a){return this.sysPosCache[a]?this.sysPosCache[a].length:
!(!this.posCache[a]||!this.posCache[a].length)},getLastPos:function(a){if(this.sysPosCache[a]){if(this.sysPosCache[a].length)return this.sysPosCache[a][this.sysPosCache[a].length-1]}else if(this.posCache[a]&&this.posCache[a].length)return this.posCache[a][this.posCache[a].length-1]},isNotSysPos:function(a){var b=this,c=!0;Snakeskin.forEach(this.sysPosCache,function(d,j){if((d=b.getLastPos(j))&&("undefined"!==typeof d.i&&d.i===a||d===a))return c=!1});return c}};for(var d,f=0,h,g="",j,l,k;++a.i<a.source.length;){j=
a.source.charAt(a.i);if(!k)if("{"===j)if(d)f++;else{d=!0;continue}else if("}"===j&&(!f||!f--)){d=!1;l=g.length;g=this._escape(g,a.quotContent).trim();j=g.split(" ")[0];j=this.Directions[j]?j:"const";g=this.Directions[j].call(this,"const"!==j?g.replace(RegExp("^"+j+"\\s+"),""):g,l,a,{commonJS:c,dryRun:b,info:e});!1===g&&(h=d=!1);g="";continue}if(d){!a.protoStart&&h&&(a.save("';"),h=!1);if((O[j]||"/"===j)&&(!a.source[a.i-1]||"\\"!==a.source[a.i-1]))k&&k===j?k=!1:k||(k=j);g+=j}else a.protoStart||(h||
(a.save("__SNAKESKIN_RESULT__ += '"),h=!0),a.parentTplName||a.save(j))}a.res=this._uescape(a.res,a.quotContent).replace(/__SNAKESKIN_ESCAPE__OR/g,"||").replace(/__SNAKESKIN_CDATA__(\d+)/g,function(a,b){return z[b].replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\v/gm,"\\v").replace(/'/gm,"&#39;")}).replace(/__SNAKESKIN_RESULT__ \+= '';/g,"");a.res+=!b?"/* Snakeskin templating system. Generated at: "+(new Date).toString()+". */":"";a.res+=c?"}":"";if(b)return a.res;console.log(a.res);s?opt_commonjs?
eval(a.res):global.eval(a.res):window.eval(a.res);return a.res};Snakeskin.Directions.template=function(a,c,b,e){var d,f,h,g="";b.startI=b.i+1;c=/(.*?)\(/.exec(a)[1];b.tplName=d=this._uescape(c,b.quotContent);if(0!==b.openBlockI)throw this.error("Missing closing or opening tag in the template (command: {"+a+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');b.openBlockI++;b.canWrite=!1!==this.write[d];e.dryRun||(/\s+extends\s+/.test(a)&&(b.parentTplName=f=this._uescape(/\s+extends\s+(.*)/.exec(a)[1],
b.quotContent)),n[d]={},m[d]={},v[d]=0,p[d]={},w[d]=0,u[d]={},x[d]=f,h=/\((.*?)\)/.exec(a)[1],b.save("/* Snakeskin template: "+d+"; "+h.replace(/=(.*?)(?:,|$)/g,"")+" */"),/\.|\[/.test(c)||e.commonJS?(c.replace(/\[/g,".").replace(/]/g,"").split(".").reduce(function(a,c,d){b.nmCache[a]||(b.save("if (typeof "+(e.commonJS?"exports.":"")+a+" === 'undefined') { "+(e.commonJS?"exports.":1===d?s?"var ":"window.":"")+a+" = {}; }"),b.nmCache[a]=!0);return"__SNAKESKIN_QUOT__"===c.substring(0,18)?a+"["+c+"]":
a+"."+c}),b.save((e.commonJS?"exports.":"")+c+"= function (")):b.save((!s?"window."+c+" = ":"")+"function "+(s?c:"")+"("),h=h.split(","),q[d]=q[f]?q[f].concat(h):h,q[f]&&q[f].forEach(function(a){var b=a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();h.forEach(function(c,d){var e=c.split("=");e[0]=e[0].trim();e[1]=e[1]&&e[1].trim();b[0]===e[0]&&"undefined"===typeof e[1]&&(h[d]=a)})}),h.forEach(function(a,c){var e=a.split("=");e[0]=e[0].trim();b.save(e[0]);1<e.length&&(q[f]&&!g&&q[f].forEach(function(a){var b=
a.split("=");b[0]=b[0].trim();b[1]=b[1]&&b[1].trim();!h.some(function(a){a=a.split("=");a[0]=a[0].trim();a[1]=a[1]&&a[1].trim();return a[0]===b[0]})&&"undefined"!==typeof b[1]&&(g+="var "+b[0]+" = "+b[1]+";",u[d][b[0]]=a)}),e[1]=e[1].trim(),g+=e[0]+" = typeof "+e[0]+" !== 'undefined' && "+e[0]+" !== null ? "+e[0]+" : "+e[1]+";");u[d][e[0]]=a;c!==h.length-1&&b.save(",")}),b.save(") { "+g+"var __SNAKESKIN_RESULT__ = '';"))};Snakeskin.Directions.templateEnd=function(a,c,b,e){var d=b.tplName,f=b.parentTplName,
h=b.source,g=b.i,j=b.startI;if(b.backHashI)throw this.error('Proto "'+b.lastBack+'" is not defined (command: {'+a+'}, template: "'+d+", "+this._genErrorAdvInfo(e.info)+'")!');if(!e.dryRun){t[d]=h.substring(j,g-c-1);if(f)return b.source=h.substring(0,j)+this._getExtStr(d,e.info)+h.substring(g-c-1),n[d]={},m[d]={},v[d]=0,p[d]={},w[d]=0,u[d]={},b.i=j-1,b.openBlockI++,!1===this.write[f]&&(b.res=b.res.replace(RegExp("/\\* Snakeskin template: "+f.replace(/([.\[\]^$])/g,"\\$1")+";[\\s\\S]*?/\\* Snakeskin template\\. \\*/",
"m"),"")),b.parentTplName=!1;b.save("return __SNAKESKIN_RESULT__; };if (typeof Snakeskin !== 'undefined') {Snakeskin.cache['"+this._uescape(d,b.quotContent).replace(/'/g,"\\'")+"'] = "+(e.commonJS?"exports.":"")+d+";}/* Snakeskin template. */");b.canWrite=!0;b.tplName=null}};Snakeskin.Directions.block=function(a,c,b,e){c=b.tplName;if(!e.dryRun&&(b.parentTplName&&!b.hasPos("block")&&!b.hasPos("proto")||!b.parentTplName)){if(n[c][a])throw this.error('Block "'+a+'" is already defined (command: {block '+
a+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+'")!');n[c][a]={from:b.i-b.startI+1}}b.pushPos("block",{name:a,i:++b.openBlockI},!0)};Snakeskin.Directions.blockEnd=function(a,c,b,e){a=b.getLastPos("block");b.popPos("block");if(!e.dryRun&&(b.parentTplName&&!b.hasPos("block")&&!b.hasPos("proto")||!b.parentTplName))n[b.tplName][a.name].to=b.i-b.startI-c-1};Snakeskin.Directions.proto=function(a,c,b,e){c=b.tplName;var d=b.parentTplName;if(!e.dryRun&&(d&&!b.hasPos("block")&&!b.hasPos("proto")||
!d)){if(m[c][a])throw this.error('Proto "'+a+'" is already defined (command: {proto'+a+'}, template: "'+c+", "+this._genErrorAdvInfo(e.info)+'")!');m[c][a]={from:b.i-b.startI+1}}b.pushPos("proto",{name:a,i:++b.openBlockI,startI:b.i+1},!0);d||(b.protoStart=!0)};Snakeskin.Directions.protoEnd=function(a,c,b,e){var d=b.tplName;a=b.parentTplName;var f=b.i,h=b.backHash,g=b.getLastPos("proto");b.popPos("proto");if(!e.dryRun&&(a&&!b.hasPos("block")&&!b.hasPos("proto")||!a))m[d][g.name].to=f-b.startI-c-1,
v[d]=f-b.startI+1;a||(m[d][g.name].body=this.compile("{template "+d+"()}"+b.source.substring(g.startI,f-c-1)+"{end}",null,!0));h[g.name]&&!h[g.name].protoStart&&(this.forEach(h[g.name],function(a){b.replace(b.res.substring(0,a)+m[d][g.name].body+b.res.substring(a))}),delete h[g.name],b.backHashI--);b.hasPos("proto")||(b.protoStart=!1)};Snakeskin.Directions.apply=function(a,c,b){!b.parentTplName&&!b.hasPos("proto")&&(m[b.tplName][a]?b.save(m[b.tplName][a].body):(b.backHash[a]||(b.backHash[a]=[],b.backHash[a].protoStart=
b.protoStart,b.lastBack=a,b.backHashI++),b.backHash[a].push(b.res.length)))};Snakeskin.Directions.forEach=function(a,c,b){b.pushPos("forEach",++b.openBlockI);!b.parentTplName&&!b.protoStart&&(a=a.split("=>"),b.save(a[0]+" && Snakeskin.forEach("+a[0]+", function ("+(a[1]||"")+") {"))};Snakeskin.Directions.forEachEnd=function(a,c,b){b.popPos("forEach");!b.parentTplName&&!b.protoStart&&b.save("});")};Snakeskin.Directions["if"]=function(a,c,b){b.openBlockI++;!b.parentTplName&&!b.protoStart&&b.save("if ("+
a+") {")};Snakeskin.Directions.elseIf=function(a,c,b){!b.parentTplName&&!b.protoStart&&b.save("} else if ("+a+") {")};Snakeskin.Directions["else"]=function(a,c,b){!b.parentTplName&&!b.protoStart&&b.save("} else {")};Snakeskin.Directions["with"]=function(a,c,b){b.pushPos("with",{scope:a,i:++b.openBlockI},!0)};Snakeskin.Directions.withEnd=function(a,c,b){b.popPos("with")};Snakeskin.Directions["const"]=function(a,c,b,e){var d,f=b.tplName,h=b.parentTplName,g=b.protoStart,j=b.i,l=b.startI;if(!h&&!g&&/console\./.test(a))b.save(a+
";");else if(/=(?!=)/.test(a))if(d=a.split("=")[0].trim(),f){if(p[f][d]||u[f][d])throw this.error('Variable "'+d+'" is already defined (command: {'+a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+'")!');if(P[d])throw this.error("Can't declare variable \""+d+'", try another name (command: {'+a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+'")!');if(b.hasPos("forEach"))throw this.error('Variable "'+d+"\" can't be defined in a loop (command: {"+a+'}, template: "'+f+", "+this._genErrorAdvInfo(e.info)+
'")!');p[f][d]={from:j-l-c,to:j-l};w[f]=j-l+1;!h&&!g&&b.save("var "+a+";")}else C[d]=!0,b.save("if (typeof Snakeskin !== 'undefined') { Snakeskin.Vars."+a+"; }");else!h&&!g&&b.save("__SNAKESKIN_RESULT__ += "+this._returnVar(a,b)+";")};Snakeskin._returnVar=function(a,c){var b="",e=!1;this.forEach(a.replace(/\|\|/g,"__SNAKESKIN_ESCAPE__OR").split("|"),function(a,f){var h,g;0===f?(c.hasPos("with")?(c.pushPos("with",{scope:a},!0),b=c.getPos("with").reduce(function(a,b){return("undefined"===typeof a.scope?
a:a.scope)+"."+b.scope}),c.popPos("with")):b=a,b="Snakeskin.Filters.undef("+(!p[c.tplName][b]&&C[b]?"Snakeskin.Vars.":"")+b+")"):(h=a.split(" "),g=h.slice(1),"!html"!==h[0]?b="Snakeskin.Filters['"+h[0]+"']("+b+(g.length?", "+g.join(""):"")+")":e=!0)});return(!e?"Snakeskin.Filters.html(":"")+b+(!e?")":"")};Snakeskin.Directions.cut=function(a,c,b){a=this._uescape(a,b.quotContent);this.write[a]||(this.write[a]=!1)};Snakeskin.Directions.save=function(a,c,b){this.write[this._uescape(a,b.quotContent)]=
!0};Snakeskin.Directions.setBEM=function(a,c,b){a=a.match(/(.*?)\s+(.*)/);this.BEM[a[1]]=(new Function("return "+this._uescape(a[2],b.quotContent)))()};Snakeskin.Directions.bem=function(a,c,b){b.pushPos("bem",{i:++b.openBlockI,tag:/\(/g.test(a)?/\((.*?)\)/.exec(a)[1]:null});var e=this;c=b.getLastPos("bem");var d,f;a=c.tag?a.replace(/^.*?\)([\s\S]*)/,"$1"):a;f=a.trim().split(",");d=a[0];c.original=this.BEM[d]&&this.BEM[d].tag;!b.parentTplName&&!b.protoStart&&(f[0]+="'",a=f.join(","),f=a.split("${"),
a="",this.forEach(f,function(c,d){var f;0<d?(f=c.split("}"),a+="\\'' + "+e._returnVar(f[0],b)+" + '\\'"+e._uescape(f.slice(1).join(""),b.quotContent).replace(/\\/g,"\\\\").replace(/('|")/g,"\\$1")):a+=e._uescape(c,b.quotContent).replace(/\\/g,"\\\\").replace(/('|")/g,"\\$1")}),b.save("__SNAKESKIN_RESULT__ += '<"+(c.tag||c.original||"div")+' class="i-bem" data-params="{name: \\\''+a+"}\">';"))};Snakeskin.Directions.bemEnd=function(a,c,b){a=b.getLastPos("bem");b.popPos("bem");b.protoStart||b.save("__SNAKESKIN_RESULT__ += '</"+
(a.tag||a.original||"div")+">';")};Snakeskin.Directions.end=function(a,c,b,e){b.openBlockI--;var d=this,f=arguments,h=b.openBlockI+1,g;0===b.openBlockI?this.Directions.templateEnd.apply(this,arguments):b.isNotSysPos(h)&&(this.forEach(b.posCache,function(a,c){if((a=b.getLastPos(c))&&("undefined"!==typeof a.i&&a.i===h||a===h))return g=!0,d.Directions[c+"End"].apply(d,f),!1}),!g&&(!b.parentTplName&&!b.protoStart)&&b.save("};"));this.forEach(b.sysPosCache,function(a,c){if((a=b.getLastPos(c))&&("undefined"!==
typeof a.i&&a.i===h||a===h))return d.Directions[c+"End"].apply(d,f),!1})};var y;if(s)for(y in Snakeskin)Snakeskin.hasOwnProperty(y)&&(exports[y]=Snakeskin[y])})("undefined"===typeof window);
