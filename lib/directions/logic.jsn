/*!
 * @status stable
 * @version 1.0.0
 */

Snakeskin.addDirective(
	'if',

	null,

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		dir.startDir(params.name);
		if (dir.isSimpleOutput(params.info)) {
			dir.save('if (' + dir.prepareOutput(command, true) + ') {');
		}
	}
);

Snakeskin.addDirective(
	'elseIf',

	null,

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (dir.structure.name !== 'if') {
			throw dir.error('Directive "' + params.name + '" can only be used with a "if", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (dir.isSimpleOutput(params.info)) {
			dir.save('} else if (' + dir.prepareOutput(command, true) + ') {');
		}
	}
);

Snakeskin.addDirective(
	'else',

	null,

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (dir.structure.name !== 'if') {
			throw dir.error('Directive "' + params.name + '" can only be used with a "if", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (dir.isSimpleOutput(params.info)) {
			dir.save('} else {');
		}
	}
);

Snakeskin.addDirective(
	'switch',

	{
		strongDirs: {
			'case': true,
			'default': true
		}
	},

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		dir.startDir(params.name);
		if (dir.isSimpleOutput(params.info)) {
			dir.save('switch (' + dir.prepareOutput(command, true) + ') {');
		}
	}
);

Snakeskin.addDirective(
	'case',

	{
		replacers: {
			'>': (cmd) => cmd.replace(/^>/, 'case '),
			'/>': (cmd) => cmd.replace(/^\/>/, 'end case')
		}
	},

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (!dir.has('switch')) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "switch", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		dir.startDir(params.name);
		if (dir.isSimpleOutput(params.info)) {
			dir.save('case ' + dir.prepareOutput(command, true) + ': {');
		}
	},

	(command, commandLength, dir) => {
		if (dir.isSimpleOutput()) {
			dir.save('} break;');
		}
	}
);

Snakeskin.addDirective(
	'default',

	null,

	(command, commandLength, dir, params) => {
		if (!dir.structure.parent) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "template" or "proto", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		if (!dir.has('switch')) {
			throw dir.error('Directive "' + params.name + '" can only be used within a "switch", ' +
				dir.genErrorAdvInfo(params.info)
			);
		}

		dir.startDir(params.name);
		if (dir.isSimpleOutput(params.info)) {
			dir.save('default: {');
		}
	}
);