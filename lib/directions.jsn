/**!
 * @status stable
 * @version 1.0.0
 */

/**
 * Добавить новую директиву
 *
 * @param {string} name - название директивы
 * @param {Object} params - дополнительные параметры
 *
 * @param {?boolean=} [params.block=false] - если true, то директива может находиться только внутри шаблона или прототипа
 * @param {?boolean=} [params.global=false] - если true, то директива может находиться только в глобальном пространстве
 * @param {?boolean=} [params.sysDir=false] - если true, то директива считается системной
 *
 * @param {Object} [params.replacers] - объект с указанием сокращений директив
 * @param {Object} [params.strongDirs] - объект с указанием директив, которые могут быть вложены в исходную
 *
 * @param {function(this:DirObj, string, number)} constr - конструктор директивы
 * @param {?function(this:DirObj, string, number)=} opt_end - окончание директивы
 */
Snakeskin.addDirective = function (name, params, constr, opt_end) {
	params = params || {};
	sysDirs[name] = !!params.sysDir;

	if (params.replacers) {
		let repls = params.replacers;

		for (let key in repls) {
			if (!repls.hasOwnProperty(key)) {
				continue;
			}

			replacers[key] = repls[key];
		}
	}

	if (params.strongDirs) {
		let dirs = params.strongDirs;

		for (let key in dirs) {
			if (!dirs.hasOwnProperty(key)) {
				continue;
			}

			strongDirs[key] = dirs[key];
		}
	}

	Snakeskin.Directions[name] = function (command, commandLength) {
		if (params.block && !this.structure.parent) {
			throw this.error('Directive "' + name + '" can only be used within a "template" or "proto"');
		}

		if (params.global && this.structure.parent) {
			throw this.error('Directive "' + name + '" can be used only within the global space');
		}

		constr.apply(this, arguments);
	};

	Snakeskin.Directions[name + 'End'] = opt_end;
};